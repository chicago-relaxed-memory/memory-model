\documentclass[t,aspectratio=169]{beamer} %tlmgr install translator
\usepackage{macros}
\usepackage{talk1}

%\includeonlyframes{oota-pomsets}  
\usepackage{pdfcomment}
% \setbeameroption{show notes on second screen}
\newcommand<>{\pdfnote}[1]{%
  \only#2{\marginnote{\pdfcomment[icon=note,hspace=10pt,color=white,hoffset=30cm]{#1}}}%
  \note#2[item]{#1}%
}
\usecolortheme{seahorse}
\usetheme{default}
\setbeamertemplate{navigation symbols}{\insertframenumber/\inserttotalframenumber}
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}[circle]
\setbeamertemplate{itemize subsubitem}[circle]


\begin{comment}
  
  While developing slides, use
  \includeonlyframes{current}  

  Then latex will only process slides with
  \begin{frame}[label=y]
  \end{frame}  
  
  \begin{frame}
    \frametitle{}
    \begin{itemize}
    \item 
    \end{itemize}
  \end{frame}
  \begin{itemize}
  \item 
  \end{itemize}

  \begin{framecenter}
  \end{framecenter}

  Great Beamer guide here:
  https://www.overleaf.com/learn/latex/Beamer_Presentations:_A_Tutorial_for_Beginners_(Part_4)â€”Overlay_Specifications

  How to present on mac without blurring:
  Use firefox, or Presentation.app
  https://tex.stackexchange.com/questions/431423/os-x-blurry-beamer-presentations-on-sierra-high-sierra

  With Presentation.app:
  \usepackage{pdfcomment}
  \newcommand{\pdfnote}[1]{\marginnote{\pdfcomment[icon=note]{#1}}}

  To convert from PDF to KeyNOTE: use the automator suggestion here
  https://apple.stackexchange.com/questions/95856/import-multiple-pages-from-a-pdf-as-separate-slides-in-keynote
  I put the automator app here: https://www.dropbox.com/sh/1o36nes45cydmbx/AADPVWpeEBZj2vemVXkGKQXVa?dl=0
  - Copy that to your machine somewhere.
  - In the finder, drop talk.pdf onto "PDF Save Pages as Images.app".
  - This will create a bunch of png files on the desktop
  - Now, open keynote with a blank document.
  - In the finder, select the files, drop onto the leftmost "slides" pane of Keynote.

  Another display option is to use http://dspdfviewer.danny-edel.de

  For Beamer notes:
  \usepackage{pgfpages}
  \setbeameroption{show notes on second screen}

  Skim is not great for this:

  To give a presentation with the Skim reader (http://skim-app.sourceforge.net) %on OSX so
  that you see the notes on your laptop and the slides on the projector, do %the following:
  
  1. Generate just the presentation (hide notes) and save to slides.pdf
  2. Generate onlt the notes (show only nodes) and save to notes.pdf
  3. With Skim open both slides.pdf and notes.pdf
  4. Click on slides.pdf to bring it to front.
  5. In Skim, under "View -> Presentation Option -> Synhcronized Noted Document"
  select notes.pdf.
  6. Now as you move around in slides.pdf the notes.pdf file will follow you.
  7. Arrange windows so that notes.pdf is in full screen mode on your laptop
  and slides.pdf is in presentation mode on the projector.
  You can use the keys "t" and "d" to get different things on the presenter screen

  \pause
  \onslide<>

  \visible<>{during}                 \begin{visibleenv}<>during\end{visibleenv}
  \invisible<>{other}                \begin{invisibleenv}<>other \end{invisibleenv}
  
  \onslide<>{during}
  \uncover<>{during}                 \begin{uncoverenv}<>during\end{uncoverenv}
  
  \only<>{during}                    \begin{onlyenv}<>during\end{onlyenv}
  \alt<>{during}{other}              \begin{altenv}<>{during-before}{during-after}{other-before}{other-after}text\end{altenv}
  \temporal<>{before}{during}{after}
  \setbeamercovered{transparent=35}


  \begin{itemize}[<+-| alert@+>]
  \end{itemize}

  \begin{columns}
    \begin{column}{0.5\textwidth}
    \end{column}
    \begin{column}{0.5\textwidth}
    \end{column}
  \end{columns}

\end{comment}

\title{Pomsets with Preconditions}
\subtitle{A Simple Model of Relaxed Memory}
\author{Radha Jagadeesan$^\dagger$ \and Alan Jeffrey$^*$ \and \alert{James Riely}$^\dagger$}
% \date{\href{https://www.cs.kent.ac.uk/research/groups/plas/seminarcalendar.html?view_by=month\&date=20201019\&category=\&tag=plas}{PLaS seminar, University of Kent}\\19 October 2020}
\date{OOPSLA\\November 2020}
\institute{$^\dagger$DePaul University \and $^*$Mozilla Research and the Servo Project}




\begin{document}
\begin{frame}[label=title]
  \maketitle
\end{frame}

\begin{frame}[label=mm]
  \frametitle{Memory model}
  What value can be read for $x$? 
  \begin{gather*}
    % x\GETS 0 \SEMI
    % \visible<3->{y\GETS0 \SEMI}
    % (
    x\GETS 1 \SEMI x\GETS 2 
    \visible<3->{\SEMI y^\mRA\GETS1 }
    \PAR
    x\GETS 3 \SEMI x\GETS 4\SEMI
    \visible<3->{r\GETS y^\mRA\SEMI}
    \alert{s\GETS x} \SEMI x\GETS 5
    % )
    \alt<4->{\\[1ex]}{\\[.5ex]}
    \hbox{\begin{tikzinline}[node distance=1.5em]
        % \event{wx0}{\DW{x}{0}}{}
        % \visible<3->{\event{wy0}{\DW{y}{0}}{right=of wx0}}
        \alt<3->{\nonevent}{\event}{wx1}{\DW{x}{1}}{}%above right=of wy0}
        \event{wx2}{\DW{x}{2}}{right=of wx1}
        \visible<3->{\event{wy1}{\DW[\mRA]{y}{1}}{right=of wx2}}
        \alt<2->{\nonevent}{\event}{wx3}{\DW{x}{3}}{below=of wx1}%below right=of wy0}
        \event{wx4}{\DW{x}{4}}{right=of wx3}
        \visible<3->{\event{ry}{\DR[\mRA]{y}{1}}{right=of wx4}}
        \event{rx}{\DR{x}{\alert{\only<-4>{?}\only<5>{2}\only<6>{4}\only<7-8>{1}}}}{right=of ry}
        \alt<2->{\nonevent}{\event}{wx5}{\DW{x}{5}}{right=of rx}
        \alt<4->{
          \wk{wx1}{wx2}
          \wk{wx3}{wx4}
          \wk{rx}{wx5}
          \sync{wx2}{wy1}
          \wk[out=-20,in=-160]{wx4}{rx}
          \sync{ry}{rx}
          \rf{wy1}{ry}
          \visible<5>{\wk{wx4}{wx2}}
          \visible<6>{\wk{wx2}{wx4}}
          \visible<7>{\wk[bend left]{wx2}{wx1}}
          \visible<8>{\wk{rx}{wx2}}
        }{
          \pox{wx1}{wx2}
          \pox{wx3}{wx4}
          \pox{rx}{wx5}
          \alt<3->{
            % \pox{wx0}{wy0}
            % \pox{wy0}{wx1}
            % \pox{wy0}{wx3}
            \pox{wx2}{wy1}
            \pox{wx4}{ry}
            \pox{ry}{rx}
            \rfx{wy1}{ry}
          }{
            % \pox{wx0}{wx1}
            % \pox{wx0}{wx3}
            \pox{wx4}{rx}
          }
        }
      \end{tikzinline}}
  \end{gather*}
  \alt<4->{\vspace{-6.7mm}}{\vspace{-5mm}}
  \begin{columns}
    \begin{column}{0.4\textwidth}\small%
      \begin{itemize}\itemsep=0pt\parskip=0pt
        \alt<4->{
        \item Labelled partial order (Pomset)
          \begin{itemize}
          \item[$\xwk$] ${\rpox}\cap x$
          \item[$\xsync$] ${\rpox}$ in to release
          \item[$\xsync$] ${\rpox}$ out of acquire
          \end{itemize}
        }{
        \item $x$--$z$: shared locations, initially $0$
        \item $r$--$s$: registers
        \item $\rpox$: program order
        \item<3-> $\rrfx$: reads-from
        \item<3-> $\DW[\mRA]{}{}$: release
        \item<3-> $\DR[\mRA]{}{}$: acquire
        }
      \end{itemize}
    \end{column}
    \begin{column}{0.5\textwidth}\small%
      \begin{itemize}\itemsep=0pt\parskip=0pt
        \alt<4->{
        \item Fulfillment
          \begin{itemize}
          \item[$\xrf$] $(\DW{x}{v})$ before $(\DR{x}{v})$
          \item[$\xwk$] Any other $(\DW{x}{})$
            \\\quad before $(\DW{x}{v})$ or
            \\\quad after $(\DR{x}{v})$
          \end{itemize}
        }{
        \item<1-> Concurrent: 1\alt<1>{\qmark}{\alt<3->{\xmark}{\cmark}} 2\alt<1>{\qmark}{\cmark{}}
        \item<1-> Sequential: 3\alt<1>{\qmark}{\xmark{}} 4\alt<1>{\qmark}{\cmark{}} 5\alt<1>{\qmark}{\xmark{}}
        }
      \end{itemize}
    \end{column}
  \end{columns}
  \pdfnote<1>{A memory model determines which writes can fulfill a read.}
  \pdfnote<2>{Can see 4, 2, 1}
  \pdfnote<2>{Not 3, 5}
  \pdfnote<3>{Synchronization hides 1}
  \pdfnote<4>{We can explain this as a partial order}
  \pdfnote<4>{Fulfillment as two requirements:}
  \pdfnote<4>{First, write must precede read}
  \pdfnote<5>{Second, other writes must be ordered before write or after read}
  \pdfnote<5>{This forces an order between the visible writes}
  \pdfnote<5>{If 2 visible, 4 hidden}
  \pdfnote<6>{If 4 visible, 2 hidden}
  \pdfnote<7>{Attempting to read 1 creates a cycle}
  \pdfnote<7>{Forcing W2 before W1, or}
  \pdfnote<8>{R1 before W2}
\end{frame}

\imagepage{images/keynote-images/keynote-images.018.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}


\begin{comment}[label=dep]
  \frametitle{Dependencies}
  Preconditions calculate dependencies
  \begin{align*}
    \begin{gathered}
      y\GETS r
      \\[1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{r{=}1\mid\DR{x}{1}}{}
        \end{tikzinline}}
    \end{gathered}
    &&
    \visible<2->{
      \begin{gathered}
        r\GETS x\SEMI y\GETS r
        \\[1ex]
        \hbox{\begin{tikzinline}[node distance=1.5em]
            \event{a}{1{=}1\mid\DR{x}{1}}{}
            \event{b}{\DW{y}{1}}{right=of a}
            \po{a}{b}
          \end{tikzinline}}
      \end{gathered}
    }
    &&
    \visible<3->{
      \begin{gathered}
        y\GETS x
        \\[1ex]
        \hbox{\begin{tikzinline}[node distance=1.5em]
            \event{a}{\DR{x}{1}}{}
            \event{b}{\DW{y}{1}}{right=of a}
            \po{a}{b}
          \end{tikzinline}}
      \end{gathered}
    }
  \end{align*}
  \vspace{-0mm}
  \begin{columns}
    \begin{column}{0.6\textwidth}\small%
      \begin{itemize}\itemsep=0pt\parskip=0pt
      \item Writes have preconditions
      \item<2-> Prefixing $r\GETS(\DR{x}{1})$ substitutes $[x/r]$ and $[1/x]$
      \item<3-> We elide tautologies
      \end{itemize}
    \end{column}
    \begin{column}{0.3\textwidth}\small%
    \end{column}
  \end{columns}
\end{comment}

\begin{frame}[label=dep]
  \frametitle{Preconditions for dependency}
  Pomset = a single execution
  \begin{gather*}
    \alt<4>{y\GETS x}{s\GETS x \SEMI y\GETS s}
    \PAR
    r\GETS y \SEMI x\GETS 1 \SEMI z\GETS r
    \\[1ex]
    \smash[b]{\hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DR{x}{1}}{}
          \event{b}{\only<-3>{\alt<1>{s}{\alert<2>{1}}{=}1\mid}\DW{y}{1}}{right=of a}
          \event{c}{\DR{y}{1}}{right=5em of b}
          \event{d}{\only<-3>{\TRUE\mid}\DW{x}{1}}{right=of c}
          \event{e}{\only<-3>{\alt<1-2>{r}{\alert<3>{1}}{=}1\mid}\DW{z}{1}}{right=of d}
          \visible<2->{
            \po{a}{b}
          }
          \visible<3->{
            \po[out=-25,in=-155]{c}{e}
          }
        \end{tikzinline}}}
  \end{gather*}
  \only<4>{\vspace{1.2mm}}
  \begin{columns}
    \begin{column}{0.6\textwidth}\small%
      \begin{itemize}\itemsep=0pt\parskip=0pt
      \item Writes have preconditions
      \item<2-> Order from $s\GETS(\DR{x}{1})$ substitutes $[1/s]$
      \item<3-> Order from $r\GETS(\DR{y}{1})$ substitutes $[1/r]$
      \item<4-> We elide tautologies 
      \end{itemize}
    \end{column}
    \begin{column}{0.3\textwidth}\small%
    \end{column}
  \end{columns}
\end{frame}


\begin{frame}<2->[label=oota]
  \frametitle{Out of \only<3->{\redxout}{order} \only<3->{thin air (OOTA)}}
  What value can be written to $z$?
  \begin{gather*}
    \alt<5->{      
      \only<5->{\tag{OOTA2\XMARK}}
      \IF{x}\THEN y\GETS 1\FI
      \PAR
      r\GETS y \SEMI \IF{\alert{r}}\THEN x\GETS1 \SEMI z\GETS r\FI
    }{
      \only<-2>{\tag{$\star$\CMARK}}
      \only<3->{\tag{OOTA1\XMARK}}
      y\GETS x
      \PAR
      r\GETS y \SEMI x\GETS \alt<3->{\alert{r}}{1} \SEMI z\GETS r
    }
    \\[1ex]
    \smash[b]{\hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DR{x}{\alt<1>{0}{1}}}{}
          \event{b}{\DW{y}{\alt<1>{0}{1}}}{right=of a}
          \event{c}{\DR{y}{\alt<1>{0}{1}}}{right=5em of b}
          \event{d}{\DW{x}{1}}{right=of c}
          \event{e}{\DW{z}{\alt<1>{0}{1}}}{right=of d}
          \po{a}{b}
          \po[out=-25,in=-155]{c}{e}
          \only<1>{
            \event{x}{\DW{x}{0}}{below=of a}
            \event{y}{\DW{y}{0}}{below=of c}
            \rf{x}{a}
            \rf{y}{c}
          }
          \visible<2->{
            \rf{b}{c}
            \rf[out=-160,in=-20]{d}{a}
          }
          \visible<3->{
            \po{c}{d}
          }
        \end{tikzinline}}}
  \end{gather*}
  \only<1>{\vspace{-2.7mm}}
  \begin{columns}
    \begin{column}{0.4\textwidth}\small%
      \begin{itemize}\itemsep=0pt\parskip=0pt
      \item Partial order
        \begin{itemize}
        \item[$\xwk$] per-location
        \item[$\xsync$] synchronization
        \item[$\xrf$] reads-from
        \item[$\xpo$] dependency
        \end{itemize}
      \end{itemize}
    \end{column}
    \begin{column}{0.5\textwidth}\small%
      \only<1->{\begin{itemize}\itemsep=0pt\parskip=0pt
        \item \only<3->{\redxout}{May reorder $r\GETS y$ and $x\GETS1$}
          \begin{itemize}
            % \item \only<3->{\redxout}{no dependency}
          \item \only<3->{\redxout}{in compiler}
          \item \only<3->{\redxout}{on ARM}
          \end{itemize}
        \item<4-> Partial order prevents!
        \item<5-> Control flow variant is DRF
        \end{itemize}}
    \end{column}
  \end{columns}
  % \only<2>{Eliding initial $(\DW{x}{0})$ $(\DW{y}{0})$}
  \pdfnote<1>{What if we have two relaxed variables, and out-of-order execution?}
  \pdfnote<1>{Can read 0, but...}
  \pdfnote<2>{Also can read 1}
\end{frame}

\imagepage{images/keynote-images/keynote-images.019.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}


\begin{comment}<-2,5->
  \frametitle{Can this program write 1 to z?}
  \begin{gather*}
    y\GETS x
    \PAR
    \alt<4>{x\GETS y}{r\GETS y \SEMI x\GETS r}
    \invisible<3-4>{\SEMI z\GETS r}
  \end{gather*}
  \onslide<2->
  $r$ is a register\\
  $x$, $y$, $z$ are shared memory locations, initially $0$

  \bigskip \bigskip
  \onslide<5->
  No!
  
  \onslide<6->
  \bigskip \bigskip
  what about
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \alert{\IF{r}\THEN} x\GETS r\SEMI z\GETS r \alert{\ELSE x\GETS1 \FI}
  \end{gather*}
\end{comment}

\begin{frame}[label=compiler]
  \frametitle{Can this program write 1 to z?}  
  \vspace{-1\baselineskip}
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \visible<2->{\alert<2>{\IF{\alert<3>{r}}\THEN}}
    x\GETS \alert<3>{r}\SEMI z\GETS \alert<3>{r}
    \visible<2->{\alert<2>{\ELSE x\GETS\alt<7>{\alert{2}}{1} \FI}}
    \only<1>{\tag{OOTA1}}
    \only<2-6>{\tag{$\star$}}
    \only<7>{\tag{OOTA3}}
  \end{gather*}
  \onslide<3->
  $x$ and $y$ can only be $0$ or $\alt<7>{\alert{2}}{1}$  
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \IF{{r}}\THEN \alert<4>{x\GETS \alt<7>{\alert{2}}{\alert<3>{1}}}\SEMI z\GETS \alt<7>{\alert{2}}{\alert<3>{1}} \ELSE \alert<4>{x\GETS\alt<7>{\alert{2}}{1}} \FI
  \end{gather*}
  \onslide<4->
  lift common code
  \begin{gather*}
    y\GETS x
    \PAR
    \alert<5>{r\GETS y}\SEMI
    \alert<4-5>{x\GETS\alt<7>{\alert{2}}{1}}\SEMI
    \IF{r}\THEN z\GETS \alt<7>{\alert{2}}{1} \FI
  \end{gather*}
  \onslide<5->
  commute independent statements
  \begin{gather*}
    \only<6>{\alert}{y\GETS x}
    \PAR
    \alert<5>{x\GETS\alt<7>{\alert{2}}{1}}\SEMI
    \alert<5>{r\GETS y}\SEMI
    \IF{r}\THEN z\GETS \alt<7>{\alert{2}}{1} \FI
  \end{gather*}
  \onslide<6->
  interleaving
  \begin{gather*}
    x\GETS\alt<7>{\alert{2}}{1}\SEMI
    \alert<6>{y\GETS x}\SEMI
    r\GETS y\SEMI
    \IF{r}\THEN z\GETS \alt<7>{\alert{2}}{1} \FI
  \end{gather*}
\end{frame}

\begin{frame}[label=oota4a]
  \frametitle{Can this program write 1 to z?}  
  \vspace{-1\baselineskip}
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \IF{\alt<2->{\alert{b}}{r}}\THEN
    x\GETS r\SEMI z\GETS r
    \ELSE x\GETS\alt<2->{1}{\alert{2}} \FI
    \only<2->{\PAR b\GETS1}
    \alt<2->{\tag{OOTA4}}{\tag{OOTA3}}
  \end{gather*}
  \redxout{$x$ and $y$ can only be $0$ or $1$}
  \begin{gather*}
    \hbox{\redxout{$
        y\GETS x
        \PAR
        r\GETS y\SEMI
        \IF{r}\THEN x\GETS r\SEMI z\GETS 1 \ELSE x\GETS1 \FI
        $}}
  \end{gather*}
  \redxout{lift common code}
  \begin{gather*}
    \hbox{\redxout{$
        y\GETS x
        \PAR
        r\GETS y\SEMI
        x\GETS1\SEMI
        \IF{r}\THEN z\GETS 1 \FI
        $}}
  \end{gather*}
  \redxout{commute independent statements}
  \begin{gather*}
    \hbox{\redxout{$
        y\GETS x
        \PAR
        x\GETS1\SEMI
        r\GETS y\SEMI
        \IF{r}\THEN z\GETS 1 \FI
        $}}
  \end{gather*}
  \redxout{interleaving}
  \begin{gather*}
    \hbox{\redxout{$
        x\GETS1\SEMI
        y\GETS x\SEMI
        r\GETS y\SEMI
        \IF{r}\THEN z\GETS 1 \FI
        $}}
  \end{gather*}
\end{frame}

\begin{frame}[label=oota4b]
  \frametitle{Can this program write 1 to z?}  
  \setbeamercovered{transparent=35}
  \vspace{-1\baselineskip}
  \begin{align*}
    \uncover<1-8>{y\GETS x
      \PAR&
      r\GETS y\SEMI
      \IF{r}\THEN
      x\GETS r\SEMI z\GETS r
      \ELSE x\GETS 1 \FI
      \only<1->{\spacetag{$\star$}}}
    \\
    \uncover<1-8>{y\GETS x
      \PAR&
      r\GETS y\SEMI
      \IF{r}\THEN
      x\GETS r\SEMI z\GETS r
      \ELSE x\GETS \alert{2} \FI
      \only<1->{\spacetag{OOTA3}}}
    \\
    y\GETS x
    \PAR&
    r\GETS y\SEMI
    \IF{\alert{b}}\THEN
    x\GETS r\SEMI z\GETS r
    \ELSE x\GETS1 \FI
    \only<4->{\mkern60mu}
    \PAR b\GETS1
    \only<-3>{\mkern60mu}
    \spacetag{OOTA4}
    \\
    \visible<4->{\uncover<4-8>{
        y\GETS x
        \PAR&
        \aReg\GETS y \SEMI \IF{\alert{b}} \THEN \aReg \GETS \NEW \classD \ELSE \bReg \GETS \NEW \classC \FI  \SEMI x \GETS \aReg 
        \PAR 
        b \GETS 1
        \only<4->{\spacetag{OOTA5}}
      }}
  \end{align*}
  \vspace{-5mm}
  \begin{itemize}    
    \only<-3>{
      \visible<2->{\item Existential justification: ARM\cmark{} ($\star$)\cmark{} OOTA1-3\cmark{} OOTA4\xmark{}
        \begin{itemize}
        \item{} Commitment (JMM - Java Memory Model) [Manson, Pugh, Adve, 2005]
        \item{} Speculation [Jagadeesan, Pitcher, Riely, 2010]
        \item{} Promising  [Kang, Hur, Lahav, Vafeiadis, Dreyer 2017]
        \end{itemize}}
      \visible<3->{\item Universal justification: ARM\xmark{} ($\star$)\cmark{} OOTA1-3\cmark{} OOTA4\cmark{}
        \begin{itemize}
        \item{} Event Structures [Jeffrey, Riely, 2016]
        \end{itemize}}
    }
    \only<4-8>{
    \item In the JMM, OOTA5 \emph{``is type correct if it declares
        $x$, $y$ and $r$ of type $\classD$. However, it has a legal execution
        where they reference a $\classC$ object.''} [Lochbihler 2013]
      \begin{itemize}
        \visible<5->{\item To prove safety, Lochbihler partitions memory by type}
        \visible<6->{
          \begin{itemize}
          \item \redxout{Realistic memory allocation}
          \item \redxout{Java Security Architecture (security-sensitive
              constants)}
          \end{itemize}}
      \end{itemize}
      \visible<7->{\item \emph{Out Of Thin Air (OOTA)} is a \emph{queasy feeling}}
      \visible<8->{\\ \emph{Compositionality} of proof rules is a \emph{verifiable property}}
    }
    \only<9->{
    \item In OOTA4, every thread satisfies:
      \begin{itemize}
      \item $\DW{y}{1}$ must be preceded by $\DR{x}{1}$        
        % \item $\DW{z}{1}$ must be preceded by $\DR{y}{1}$        
      \item if $\DW{z}{1}$, then $\DW{x}{1}$ must be preceded by
        $\DR{y}{1}$
      \item
        In PLTL:
        \begin{math}
          [\once\DW{y}{1} \Rightarrow \once\DR{x}{1}]
          \land
          [\notonce\DW{z}{1} \Rightarrow (\once\DR{y}{1} \land \always(\DW{x}{1} \Rightarrow \once\DR{y}{1}))]
        \end{math}
      \end{itemize}
      \visible<10->{
      \item Compositionality: every thread satisfies $\Longrightarrow$ program satisfies
        \begin{itemize}
        \item $\exists$ justification: compositional for predicate logic OOTA1-3
        \item $\forall$ justification: compositional for temporal logic OOTA4-5
        \end{itemize}}
    }
  \end{itemize}  
\end{frame}

\begin{comment}
  \frametitle{Reading Values Out Of Thin Air (OOTA)}
  Eliding $0$-initialization:
  \begin{gather*}
    % y\GETS0\SEMI
    y\GETS x
    \PAR
    % x\GETS0\SEMI
    % z\GETS0\SEMI
    r\GETS y \SEMI \IF{\alt<1>{r\mkern2mu}{\alert<2>{b}}}\THEN  x\GETS r \SEMI z\GETS r \ELSE x\GETS1 \FI
    \visible<2->{\alert<2>{\PAR
        % b\GETS0\SEMI
        b\GETS1}}
    \\
    \hbox{\begin{tikzinline}[node distance=1.5em]
        \event{rx}{\DR{x}{1}}{}
        \event{wy}{\DW{y}{1}}{right=of rx}
        \po{rx}{wy}
        \event{ry}{\DR{y}{1}}{right=3em of wy} 
        \event{wx}{\DW{x}{1}}{right=of ry}
        \event{wz}{\DW{z}{1}}{right=of wx}
        \rf{wy}{ry}
        \rf[out=-160,in=-20]{wx}{rx}
        \po[out=-28,in=-152]{ry}{wz}
        \visible<2->{
          \po{ry}{wx}
          \event{rb}{\DR{b}{1}}{right=of wz}
          \event{wb1}{\DW{b}{1}}{right=3em of rb}
          \po{rb}{wz}
          \rf{wb1}{rb}
        }
      \end{tikzinline}}
  \end{gather*}
  \begin{itemize}    
  \item<3->
    Proof using
    \begin{scope}
      \small
      \begin{math}
        [\once\DW{y}{1} \Rightarrow \once\DR{x}{1}]
        \land
        [\notonce\DW{z}{1} \Rightarrow (\once\DR{y}{1} \land \always(\DW{x}{1} \Rightarrow \once\DR{y}{1}))]
      \end{math}
    \end{scope}

  \item<4-> Semantics using existential justification get this wrong:
    \begin{itemize}
    \item{} Commitment (JMM) [Manson, Pugh, Adve, 2005]
    \item{} Speculation [Jagadeesan, Pitcher, Riely, 2010]
    \item{} Promising  [Kang, Hur, Lahav, Vafeiadis, Dreyer 2017]
    \end{itemize}
  \item<5-> Semantics using universal justification get this right:
    \begin{itemize}
    \item{} Event Structures [Jeffrey, Riely, 2016]
      \visible<5->{\\But this model is too strong (eg, inefficient on ARM)}
    \end{itemize}
  \end{itemize}
\end{comment}

\begin{frame}<2->[label=oota-pomsets]
  \frametitle{Comparing attempted executions}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \tag{$\star$\CMARK}
    y\GETS x
    \PAR
    r\GETS y\SEMI \IF{\alert{r}}\THEN 
    x\GETS r\SEMI z\GETS r \ELSE x\GETS1 \FI
    \visible<1>{\PAR b\GETS1}
    \\
    \hbox{\begin{tikzinline}[node distance=1.5em]
        \event{rx1}{\DR{x}{1}}{}
        \event{wy1}{\DW{y}{1}}{right=of rx1}
        \event{ry1}{\DR{y}{1}}{right=3em of wy1}
        \event{wx1}{\DW{x}{1}}{right=of ry1}
        \event{wa1}{\DW{z}{1}}{right=of wx1}
        \visible<1>{
          \event{rb}{\DR{b}{1}}{right=of wa1}
          \event{wb1}{\DW{b}{1}}{right=3em of rb}
        }
        \rf[out=-165,in=-15]{wx1}{rx1}
        \rf{wy1}{ry1}
        \po{rx1}{wy1}
        \po[out=20,in=160]{ry1}{wa1}
      \end{tikzinline}}
    \\[1ex]
    \tag{OOTA4\XMARK}
    y\GETS x
    \PAR
    r\GETS y \SEMI \IF{\alert{b}}\THEN  x\GETS r \SEMI z\GETS r \ELSE x\GETS1 \FI
    \PAR
    b\GETS1
    \\[.5ex]
    \hbox{\begin{tikzinline}[node distance=1.5em]
        \event{rx}{\DR{x}{1}}{}
        \event{wy}{\DW{y}{1}}{right=of rx}
        \po{rx}{wy}
        \event{ry}{\DR{y}{1}}{right=3em of wy} 
        \event{wx}{\DW{x}{1}}{right=of ry}
        \event{wz}{\DW{z}{1}}{right=of wx}
        \event{rb}{\DR{b}{1}}{right=of wz}
        \event{wb1}{\DW{b}{1}}{right=3em of rb}
        \po{ry}{wx}
        \rf{wb1}{rb}
        \rf{wy}{ry}
        \rf[out=-170,in=-10]{wx}{rx}
        \po{rb}{wz}
        \po[out=15,in=165]{ry}{wz}
      \end{tikzinline}}
  \end{gather*}
\end{frame}
% \imagepage{images/abomb3.jpg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=198310}{Image in the Public domain}}
% \imagepage{images/flowers.jpg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.020.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

\begin{frame}[label=hard]
  \frametitle{It's hard...}
  \begin{itemize}
  \item<1-> Programmer desiderata

    \begin{itemize}
    \item Compositional/local reasoning
    \item Sequential Consistency for Data Race Free programs (SC-DRF)
    \end{itemize}
  \item<2-> Implementer desiderata
    \begin{itemize}
    \item Efficient on \only<3->{\redxout}{hardware} \only<3->{\alert{MCA} hardware}
    \item Compiler optimizations
    \end{itemize}
  \item<3-> Multi-copy atomicity (MCA)
    \begin{itemize}
    \item When write published to one processor, published to all
    \item ARM\cmark{} x86-64\cmark{} RISC-V\cmark{} POWER\xmark{} %, e.g. \texttt{IRIW+dmb.ld}\xmark{}
    \item Prevents anomalies:
    \end{itemize}
    \vspace{-3mm}
    \onslide<3->
    \begin{gather*}
      \tag{MCA3\XMARK}
      \begin{gathered}
        r\GETS x\SEMI x\GETS 1
        \PAR
        y\GETS x 
        \PAR
        x\GETS y 
        \\[-1.2ex]
        \hbox{\begin{tikzinline}[node distance=1.5em]
            \event{a}{\DR{x}{\alert{1}}}{}
            \event{b}{d:\DW{x}{1}}{right=of a}
            \wk{a}{b}
            \event{c}{\DR{x}{1}}{right=3em of b}
            \event{d}{\DW{y}{1}}{right=of c}
            \po{c}{d}
            \event{e}{\DR{y}{1}}{right=3em of d}
            \event{f}{e:\DW{x}{1}}{right=of e}
            \po{e}{f}
            \rf{b}{c}
            \rf{d}{e}
            \rf[out=172,in=8]{f}{a}
          \end{tikzinline}}
      \end{gathered}
    \end{gather*}
  \end{itemize}
\end{frame}

\begin{frame}<2,5>[label=before]
  \frametitle{We've been trying for 20 years...}
  \begin{itemize}
  \item<1-> Operational with alternate executions: ARM\cmark{} OOTA\xmark{}
    \begin{itemize}
    \item Java 1.1 fails CSE [Pugh 1999]
    \item Commitment/Speculation/Promises [2005, \alert{2010}, 2017]      
    \end{itemize}
  \item<2-> Strong models: ARM\xmark{} OOTA\cmark{}
    \begin{itemize}
    \item SC [Singh, Narayanasamy, Marino,  Millstein,  Musuvathi 2012]
    \item RC11 [Lahav, Vafeiadis 2016]
    \item Event Structures [\alert{2016}]
    \end{itemize}
  \item<3-> Operational with compiler rewrites
    \begin{itemize}
    \item{} [Ferreira, Feng, Shao 2010],  [Pichon-Pharabod, Sewell 2016]
    \end{itemize}
  \item<4-> Symbolic execution with multiple orders and acyclicly requirements
    \begin{itemize}
    \item Hardware [Alglave 2010], [Alglave,  Maranget,  Tautschnig 2014]
    \item C++ [Batty, Owens, Sarkar,  Sewell,  Weber 2011]
    \end{itemize}
  \item<5-> Event Structures
    \begin{itemize}
    \item{} WeakestMO [Chakraborty, Vafeiadis 2019]
    \item{} Modularity [Paviotti, Cooksey, Paradis, Wright, Owens, Batty 2020]
    \end{itemize}
  \end{itemize}
\end{frame}

\imagepage{images/keynote-images/keynote-images.008.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.021.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.022.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.023.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.011.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.012.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.013.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.009.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}


\imagepage{images/keynote-images/keynote-images.007.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

% \imagepage{images/katorisi.jpeg}{\href{https://commons.wikimedia.org/wiki/File:Tulips,Hitachi_Seaside_Park,Hitachinaka-city,Japan.JPG}{Image
% by Katorisi, 2010, Creative Commons}}


\begin{frame}
  \frametitle{Semantic Domain}
  \begin{itemize}
  \item 
    A \emph{pomset with preconditions} is a tuple
    $(\Event, {\le}, %{\leloc},
    \labeling)$ where
    \begin{itemize}
    \item $\Event$ is a set of \emph{events}
    \item ${\le} \subseteq (\Event\times\Event)$ is a partial order
    \item<+-> $\labeling: \Event \fun (\Formulae\times\Act)$ is a \emph{labeling}
      from which we derive functions
      \begin{itemize}
      \item $\labelingForm:\Event\fun\Formulae$ \emph{(formulae)} % include $r{=}v$  $x{=}v$
      \item $\labelingAct:\Event\fun\Act$  \emph{(actions)} %include $\DW{x}{v}$, $\DR{x}{v}$, and $\DSTOP$
      \end{itemize}
    \item<+-> $\bigwedge_{\aEv}\labelingForm(\aEv)$ is satisfiable
      \emph{(consistency)}
    \item<2-> if $\bEv\le\aEv$ then $\labelingForm(\aEv)$ implies
      $\labelingForm(\bEv)$ \emph{(causal strengthening)}
    \end{itemize}
  \item<+->
    We say $\labelingAct(\bEv)=(\DW{x}{v})$ \emph{fulfills} $\labelingAct(\aEv)=(\DR{x}{v})$ if 
    % We say $\bEv$ \emph{fulfills $\aEv$} if 
    % % \labeltextsc[F1]{(F1)}{rf1}
    % $\labelingAct(\bEv)=\DW{x}{v}$,
    % % \labeltextsc[F2]{(F2)}{rf2}
    % $\labelingAct(\aEv)=\DR{x}{v}$,
    \begin{itemize}
      % \item[{\labeltextsc[F1]{(F1)}{rf1}}] $\labelingAct(\bEv)=\DW{x}{v}$,
      % \item[{\labeltextsc[F2]{(F2)}{rf2}}] $\labelingAct(\aEv)=\DR{x}{v}$,
    \item%[{\labeltextsc[F3]{(F3)}{rf3}}]
      $\bEv \lt \aEv$
    \item%[{\labeltextsc[F4]{(F4)}{rf4}}]
      if $\labelingAct(\cEv)=(\DW{x}{..})$ then either $\cEv \le \bEv$ or $\aEv \le \cEv$
    \end{itemize}
  \item<+->
    A pomset is \emph{$\aLoc$-closed} if
    \begin{itemize}
    \item every $\labelingAct(\aEv)=(\DR{\aLoc}{..})$ is fulfilled
    \item every $\labelingForm(\aEv)$ is independent of $x$: $\bigl(\forall v.\;\labelingForm(\aEv) \vDash \labelingForm(\aEv)[\aVal/\aLoc] \vDash
      \labelingForm(\aEv)\bigr)$
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Semantic Operations (1/2)}
  \begin{itemize}[<+->]
  \item
    Let $\aPS\phantom{'}\in(\nu\aLoc\!\DOT\!\aPSS) \mkern22mu$ when $\phantom{(\exists}\aPS\in\aPSS$
    and $\aPS$ is $\aLoc$-closed
    % Let $(\nu\aLoc\!\DOT\!\aPSS)$ be  $\aPSS'\subseteq\aPSS$ where $\aPS'\in\aPSS'$
    % when $\aPS'$ is $\aLoc$-closed
  \item 
    % Let $(\aForm \guard \aPSS)$ be the set $\aPSS'\subseteq\aPSS$ where
    % $\aPS'\in\aPSS'$ when $\labelingForm(\aEv')$ implies $\aForm$
    Let $\aPS\phantom{'}\in(\aForm \guard \aPSS)\mkern16mu$ when $\phantom{(\exists}\aPS\in\aPSS$ and 
    $(\forall\aEv\in\Event)$ $\labelingForm(\aEv)$ implies $\aForm$
  \item 
    Let $\aPS'\in(\aPSS[M/x])\mkern2mu$ when
    $(\exists\aPS\in\aPSS$)\\\qquad $\Event' = \Event$, ${\le'} = {\le}$,
    $\labelingAct' = \labelingAct$, and
    $(\forall\aEv\in\Event')$ $\labelingForm'(\aEv) = \labelingForm(\aEv)[M/x]$
    % % Let $(\aPSS\aSub)$
    % Let $(\aPSS[M/x])$
    % be the set $\aPSS'$ where $\aPS'\in\aPSS'$ when there is
    % $\aPS\in\aPSS$ where\\ $\Event' = \Event$, ${\le'} = {\le}$,
    % $\labelingAct' = \labelingAct$, and
    % $\labelingForm'(\aEv) = \labelingForm(\aEv)[M/x]$
    % % $\labelingForm'(\aEv) = \labelingForm(\aEv)\aSub$
    
    
  \item 
    Let $\aPS' \in (\aPSS^1 \parallel \aPSS^2)$ when
    $(\exists\aPS^1 \in \aPSS^1)$ $(\exists\aPS^2 \in \aPSS^2)$
    \\% $\aPS^1$ is completed exactly when $\aPS^2$ is completed, there is at most one termination in $\Event'$,
    \qquad $\Event' = \Event^1 \cup \Event^2$,
    ${\le'}\supseteq{\le^1}\cup{\le^2}$, and $(\forall\aEv\in\Event')$ either
    \begin{gather*}
      \begin{aligned}
        \aEv \not\in \Event^2,\; \labelingAct'(\aEv) &= \labelingAct^1(\aEv) \textAnd \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv),
        \\[-1ex]
        \aEv \not\in \Event^1,\; \labelingAct'(\aEv) &= \labelingAct^2(\aEv) \textAnd \labelingForm'(\aEv) \textimplies \labelingForm^2(\aEv),\textor
        \\[-1ex]
        \labelingAct'(\aEv) = \labelingAct^1(\aEv) &= \labelingAct^2(\aEv) \textAnd \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv) \lor \labelingForm^2(\aEv)
      \end{aligned}
    \end{gather*}
    % \begin{itemize}
    % \item $\labelingAct'(\aEv) = \labelingAct^1(\aEv) = \labelingAct^2(\aEv) \textAnd \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv) \lor \labelingForm^2(\aEv),$
    % \item $\aEv \not\in \Event^2,\; \labelingAct'(\aEv) = \labelingAct^1(\aEv) \textAnd \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv),$ or
    % \item $\aEv \not\in \Event^1,\; \labelingAct'(\aEv) = \labelingAct^2(\aEv) \textAnd \labelingForm'(\aEv) \textimplies \labelingForm^2(\aEv)$.
    % \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}<1-2>
  \setbeamercovered{transparent=20}
  \frametitle{Semantic Operations (2/2)}
  \begin{itemize}
  \item Let $\aPS'\in(\aForm \mid \aAct) \prefix \aPSS$ when
    $(\exists\aPS\in\aPSS)$
    $(\forall\aEv\in\Event)$
    \begin{enumerate}
    \item[{\labeltextsc[P1]{(P1)}{1}}]
      $\Event' = \Event \cup \{\bEv\}$
    \item<1>[{\labeltextsc[P2]{(P2)}{2}}]
      ${\le'}\supseteq{\le}$
    \item<1>[{\labeltextsc[P3]{(P3a)}{3a}\labeltextsc[P3]{}{3}}]%
      $\labelingAct'(\aEv) = \labelingAct(\aEv)$
    \item<1>[{\labeltextsc[P3b]{(P3b)}{3b}}]
      $\labelingAct'(\bEv) = \aAct$
    \item<1>[{\labeltextsc[P4a]{(P4a)}{4a}\labeltextsc[P4]{}{4}}]%
      $\labelingForm'(\bEv)$ implies $\aForm\land(\bEv\not\in\Event\lor\labelingForm(\bEv))$
      % \\
      % if $\bEv\not\in\Event$ then $\labelingForm'(\bEv)$ implies
      % $\aForm$;
      % if $\bEv\in\Event$ then $\labelingForm'(\bEv)$ implies
      % $\aForm\lor\labelingForm(\bEv)$;
    \item[{\labeltextsc[P4b]{(P4b)}{4b}}]
      if $\bEv\neq(\DR{..)}{}\mkern86mu$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$
    \item[{\labeltextsc[P4c]{(P4c)}{4c}}]
      if $\bEv=(\DR{\aVal}{\aLoc})\mkern75mu$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)[\aVal/\aLoc]$
    \item[{\labeltextsc[P5a]{(P5a)}{5a}\labeltextsc[P5]{}{5}}]%
      if $\bEv=(\DR{..)}{}$, $\aEv=(\DW{..)}{}$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$ or $\bEv\le'\aEv$
    \item<1>[{\labeltextsc[P5b]{(P5b)}{5b}}]
      if $\bEv$ and $\aEv$ are conflicting actions then $\bEv\le'\aEv$
    \item<1>[{\labeltextsc[P5c]{(P5c)}{5c}}]
      if $\bEv$ is an acquire or $\aEv$ is a release then $\bEv \le' \aEv$
    \item<1>[{\labeltextsc[P5d]{(P5d)}{5d}}]
      if $\bEv$ is an SC write and $\aEv$ is an SC read then $\bEv \le' \aEv$
    \item<1>[{\labeltextsc[P5e]{(P5e)}{5e}}] if $\bEv$ reads, and $\aEv$ is an acquiring fence, then
      $\bEv \le' \aEv$
    \item<1>[{\labeltextsc[P5f]{(P5f)}{5f}}] if $\bEv$ is a releasing fence, and $\aEv$ writes, then
      $\bEv \le' \aEv$
    \end{enumerate}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Language {\color{gray}\normalsize(See paper for RMWs and address calculation)}}
  \vspace{-5mm}
  \begin{gather*}
    % \begin{aligned}
    %   \aCmd,\,\bCmd
    %   \BNFDEF& \SKIP
    %   \BNFSEP \aReg\GETS\aExp\SEMI \aCmd
    %   \BNFSEP \aReg\GETS\aLoc^{\amode}\SEMI \aCmd 
    %   \BNFSEP \aLoc^{\amode}\GETS\aExp\SEMI \aCmd
    %   \\[-.5ex]
    %   \BNFSEP&\aCmd \PAR[\aThrd][\bThrd] \bCmd
    %   \BNFSEP \VAR\aLoc\SEMI \aCmd
    %   \BNFSEP \IF{\aExp} \THEN \aCmd \ELSE \bCmd \FI
    % \end{aligned}
    % \\
    \begin{aligned}
      \sem[\aThrd]{\SKIP} & \eqdef
      \alert<2>{\{ \DSTOP \}}
      \\
      \sem[\aThrd]{\aReg\GETS\aExp\SEMI \aCmd} & \eqdef
      \sem[\aThrd]{\aCmd}\alert<3>{[\aExp/\aReg]}
      \\ 
      \sem{\aReg\GETS\aLoc^{\visible<1->{\alert<1>{\amode}}}\SEMI \aCmd} & \eqdef \textstyle\bigcup_\aVal\;
      \alert<4>{(\DR[\visible<1->{\alert<1>{\amode}}]\aLoc\aVal)\prefix} \sem{\aCmd} \alert<3>{[\aLoc/\aReg]}
      \\
      \sem{\aLoc^{\visible<1->{\alert<1>{\amode}}}\GETS\aExp\SEMI \aCmd} & \eqdef
      \textstyle\bigcup_\aVal\; \alert<4>{(\aExp=\aVal \mid \DW[\visible<1->{\alert<1>{\amode}}]\aLoc\aVal)\prefix} \sem{\aCmd}\alert<3>{[\aExp/\aLoc]}
      \\
      \sem{\FENCE^{\visible<1->{\alert<1>{\fmode}}}\SEMI \aCmd} & \eqdef
      \alert<4>{(\DFS{\visible<1->{\alert<1>{\fmode}}}) \prefix} \sem{\aCmd}
      \\
      \sem[\aThrd]{\IF{\aExp} \THEN \aCmd \ELSE \bCmd \FI} & \eqdef
      \bigl(\alert<5>{\aExp \guard} \sem[\aThrd]{\aCmd}\bigr) \alert<6>{\parallel} \bigl(\alert<5>{\lnot\aExp \guard} \sem[\aThrd]{\bCmd}\bigr) 
      \\
      \sem[\aThrd]{\aCmd \PAR[\bThrd][\bThrd'] \bCmd} & \eqdef
      \sem[\bThrd]{\aCmd} \alert<6>{\parallel} \sem[\bThrd']{\bCmd} 
      \\
      \sem[\aThrd]{\VAR\aLoc\SEMI \aCmd} & \eqdef
      \alert<7>{\nu \aLoc \DOT} \sem[\aThrd]{\aCmd}  
    \end{aligned}
  \end{gather*}
  \visible<1->{
    \begin{align*}
      \alert<1>{\amode} \BNFDEF& \mRLX &&\text{{(Relaxed)}} &\alert<1>{\fmode} \BNFDEF&\mREL  &&\text{(Release)} &\hbox{$\;\mkern60mu\;$}&
      \\ \BNFSEP& \mRA &&\text{{(Release/Acquire)}}            & \BNFSEP&\mACQ   &&\text{(Acquire)} 
      \\ \BNFSEP& \mSC &&\text{{(Sequentially Consistent)}}    &      \BNFSEP&\mSC  &&\text{(SC)} 
    \end{align*}}
\end{frame}

\imagepage{images/keynote-images/keynote-images.007.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

\begin{imageframe}{images/keynote-images/keynote-images.014.jpeg}[label=seq1]
  \frametitle{Sequential Semantics: Preconditions}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      \only<9->{\IF{r}\THEN}
      \only<4->{x\GETS r\SEMI}
      z\GETS r
      \only<9->{\FI}
      \\
      \only<1>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}0\mid\DW{z}{0}}{}
          \end{tikzinline}}}
      \only<2>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}1\mid\DW{z}{1}}{}
          \end{tikzinline}}}
      \only<3>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}2\mid\DW{z}{2}}{}
          \end{tikzinline}}}
      \only<4>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}0\mid\DW{z}{0}}{}
            \event{wx}{r{=}0\mid\DW{x}{0}}{left=of wz}
          \end{tikzinline}}}
      \only<5,8>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}1\mid\DW{z}{1}}{}
            \event{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
      \only<6-7>{\hbox{\begin{tikzinline}[node distance=.5em]
            \alt<7>{\nonevent}{\event}{wz}{r{=}\alert{2}\mid\DW{z}{\alert{2}}}{}
            \alt<7>{\nonevent}{\event}{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
      \only<9>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{\neq}0 \land r{=}1\mid\DW{z}{1}}{}
            \event{wx}{r{\neq}0 \land r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
      \only<10->{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}1\mid\DW{z}{1}}{}
            \event{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
    \end{gathered}
    \only<8->{\qquad \qquad\qquad\begin{gathered}
        \only<9->{\IF{\lnot r}\THEN}
        x\GETS \alt<12-13>{\alert<12>{2}}{1}
        \only<9->{\FI}
        \\
        \only<8>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{1{=}1\mid\DW{x}{1}}{}
            \end{tikzinline}}}
        \only<9>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{r{=}0 \land 1{=}1\mid\DW{x}{1}}{}
            \end{tikzinline}}}
        \only<10-11>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{r{=}0\mid\DW{x}{1}}{}
            \end{tikzinline}}}
        \only<12-13>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{r{=}0\mid\DW{x}{\alert<12>{2}}}{}
            \end{tikzinline}}}
      \end{gathered}}
  \end{gather*}
  \begin{center}
    \only<1>{\;\;\;\;\;\;\;\; Precondition records dependence on $r$}
    \only<2-3>{\;\;\;\; One pomset for each value}
    \only<4-5>{\;\;\;\; Two writes = two events per pomset}
    \only<6-7>{Preconditions must be consistent}
    \only<6-7>{\\\;\;\; Pomset = a single execution}
    \only<8>{A separate program}
    \only<9>{Adding control}
    \only<10>{Simplifying}
    \only<11->{Combining both sides}
  \end{center}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \only<11->{\IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS \alt<12-13>{\alert<12>{2}}{1}\FI}
    \\
    \only<11>{\hbox{\begin{tikzinline}[node distance=.5em]
          \event{wz}{r{=}1\mid\DW{z}{1}}{}
          \event{wx}{r{=}1\lor r{=}0\mid\DW{x}{1}}{left=of wz}
        \end{tikzinline}}}    
    \only<12-13>{\hbox{\begin{tikzinline}[node distance=.5em]
          \alt<12>{\event}{\nonevent}{wz}{r{=}1\mid\DW{z}{1}}{}
          \alt<12>{\event}{\nonevent}{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \alt<12>{\event}{\nonevent}{wxx}{\alert<13>{r{=}0}\mid\DW{x}{\alert<12>{2}}}{right=of wz}
        \end{tikzinline}}}    
  \end{gather*}
  \begin{center}
    \only<11>{We can coalesce the writes to $x$}
    \only<12>{We \emph{cannot} coalesce the writes to $x$}
    \only<13->{Preconditions must be consistent}
  \end{center}
\end{imageframe}


\begin{imageframe}{images/keynote-images/keynote-images.014.jpeg}
  \frametitle{Sequential Semantics: Preconditions}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \visible<8->{y\GETS 0\SEMI}
    \visible<2->{r\GETS y\SEMI}
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS 1\FI
    \\
    \only<1-2>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wz}{\alt<1>{r}{y}{=}1\mid\DW{z}{1}}{}
          \event{wx}{\alt<1>{r}{y}{=}1\lor \alt<1>{r}{y}{=}0\mid\DW{x}{1}}{left=of wz}
        \end{tikzinline}}}
    \only<3>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{(y{=}1\lor y{=}0)\land(1{=}1\lor 1{=}0)\mid\DW{x}{1}}{}
          \event{wz}{(y{=}1) \land (1{=}1)\mid\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
        \end{tikzinline}}}
    \only<4-5>{\hbox{\begin{tikzinline}[node distance=2em]
          \alt<4>{\event}{\nonevent}{wx}{(y{=}1\lor y{=}0)\land(\alert{2}{=}1\lor \alert{2}{=}0)\mid\DW{x}{1}}{}
          \alt<4>{\event}{\nonevent}{wz}{(y{=}1) \land (\alert{2}{=}1)\mid\DW{z}{1}}{right=of wx}
          \alt<4>{\event}{\nonevent}{ry}{\DR{y}{\alert{2}}}{left=of wx}
        \end{tikzinline}}}
    \only<6-7>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{(y{=}1\lor y{=}0)\land(1{=}1\lor 1{=}0)\mid\DW{x}{1}}{}
          \event{wz}{(\alt<6>{y}{\alert{1}}{=}1) \land (1{=}1)\mid\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \po[out=-15,in=-165]{ry}{wz}
        \end{tikzinline}}}
    \only<8>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{(\alert{0}{=}1\lor \alert{0}{=}0)\land(1{=}1\lor 1{=}0)\mid\DW{x}{1}}{}
          \event{wz}{(1{=}1) \land (\alert{1}{=}1)\mid\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{0{=}0\mid\DW{y}{0}}{left=of ry}
          \po[out=-15,in=-165]{ry}{wz}
        \end{tikzinline}}}
    \only<9>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \po[bend right]{ry}{wz}
        \end{tikzinline}}}
  \end{gather*}
  \begin{center}
    \only<1>{Let's start fresh here}
    \only<2>{To prepend, $r\GETS y $, we first substitute $[y/r]$}
    \only<3>{We then add the action, and its constraint: $\aForm'\vDash\aForm[v/y]$}
    \only<4-5>{Incompatible reads are disallowed}
    \only<6>{Order may be introduced}
    \only<7>{Order enables substitution $[v/y]$}
    \only<8>{Prepending $y\GETS 0$ substitutes $[0/y]$}
    \only<8>{\\{}Order imposed by sub? Write\xmark{} Read\cmark{} }
    % \alert{1}/y] from $\DR{y}{1}$ requires order, [\alert{0}/y] from $\DW{y}{0}$ does not}
    \only<9>{Simplifying tautologies}
  \end{center}
\end{imageframe}

\begin{imageframe}{images/keynote-images/keynote-images.015.jpeg}<1-3>
  \frametitle{Concurrent Semantics: Fulfillment}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \only<2->{x\GETS 0\SEMI}
    y\GETS 0\SEMI
    \only<3->{(y\GETS x \PAR}
    r\GETS y\SEMI
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS \alt<9>{\alert{2}}{1}\FI
    \only<3->{)}
    \\
    \only<1>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \po[out=-28,in=-152]{ry}{wz}
          \wk{wy}{ry}
        \end{tikzinline}}}
    \only<2>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \event{wx0}{\DW{x}{0}}{left=of wy}
          \po[out=-28,in=-152]{ry}{wz}
          \wk{wy}{ry}
          \wk[out=-22,in=-158]{wx0}{wx}
        \end{tikzinline}}}
    \only<3->{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wy0}{\DW{y}{0}}{}
          \event{wx0}{\DW{x}{0}}{left=of wy0}
          \event{rx1}{\DR{x}{1}}{right=3em of wy0}
          \event{wy1}{\DW{y}{1}}{right=of rx1}
          \event{ry1}{\DR{y}{1}}{right=3em of wy1}
          \event{wx1}{\DW{x}{1}}{right=of ry1}
          \event{wa1}{\DW{z}{1}}{right=of wx1}
          \only<3>{
            \wk[out=-22,in=-158]{wx0}{rx1}
            \wk[out=-22,in=-158]{wy0}{ry1}
          }
          \only<4->{
            \rf[out=-165,in=-15]{wx1}{rx1}
            \rf{wy1}{ry1}
          }
          \only<9->{
            \po{ry1}{wx1}
          }
          \wk[out=-18,in=-162]{wx0}{wx1}
          \wk[out=-22,in=-158]{wy0}{wy1}
          \po{rx1}{wy1}
          \po[out=-28,in=-152]{ry1}{wa1}
        \end{tikzinline}}}
  \end{gather*}
  \begin{center}
    \only<1>{Must preserve order on \emph{conflicting} accesses (WW, WR)}
    \only<2>{Initializing $x$}
    \only<3>{Introducing $y\GETS x$}
    \only<4>{Fulfillment requirements}
    \only<5-8>{Allowed!
      \visible<6->{\\ Partial order}
      \visible<7->{\\ All reads fulfilled}
      \visible<8->{\\ All preconditions tautologies}
    }
    \only<9->{Disallowed!
      \visible<9->{\\ Cycle}
    }
  \end{center}
\end{imageframe}
\begin{imageframe}{images/keynote-images/keynote-images.024.jpeg}<4-> %or 16
  \frametitle{Concurrent Semantics: Fulfillment}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \only<3-8>{\tag{$\star$\CMARK}}
    \only<9->{\tag{OOTA3\XMARK}}
    \only<2->{x\GETS 0\SEMI}
    y\GETS 0\SEMI
    \only<3->{(y\GETS x \PAR}
    r\GETS y\SEMI
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS \alt<9>{\alert{2}}{1}\FI
    \only<3->{)}
    \\
    \only<1>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \po[out=-28,in=-152]{ry}{wz}
          \wk{wy}{ry}
        \end{tikzinline}}}
    \only<2>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \event{wx0}{\DW{x}{0}}{left=of wy}
          \po[out=-28,in=-152]{ry}{wz}
          \wk{wy}{ry}
          \wk[out=-22,in=-158]{wx0}{wx}
        \end{tikzinline}}}
    \only<3->{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wy0}{\DW{y}{0}}{}
          \event{wx0}{\DW{x}{0}}{left=of wy0}
          \event{rx1}{\DR{x}{1}}{right=3em of wy0}
          \event{wy1}{\DW{y}{1}}{right=of rx1}
          \event{ry1}{\DR{y}{1}}{right=3em of wy1}
          \event{wx1}{\DW{x}{1}}{right=of ry1}
          \event{wa1}{\DW{z}{1}}{right=of wx1}
          \only<3>{
            \wk[out=-22,in=-158]{wx0}{rx1}
            \wk[out=-22,in=-158]{wy0}{ry1}
          }
          \only<4->{
            \rf[out=-165,in=-15]{wx1}{rx1}
            \rf{wy1}{ry1}
          }
          \only<9->{
            \po{ry1}{wx1}
          }
          \wk[out=-18,in=-162]{wx0}{wx1}
          \wk[out=-22,in=-158]{wy0}{wy1}
          \po{rx1}{wy1}
          \po[out=-28,in=-152]{ry1}{wa1}
        \end{tikzinline}}}
  \end{gather*}
  \begin{center}
    \only<1>{Must preserve order on \emph{conflicting} accesses (WW, WR)}
    \only<2>{Initializing $x$}
    \only<3>{Introducing $y\GETS x$}
    \only<4>{Fulfillment requirements}
    \only<5-8>{Allowed!
      \visible<6->{\\ Partial order}
      \visible<7->{\\ All reads fulfilled}
      \visible<8->{\\ All preconditions tautologies}
    }
    \only<9->{Disallowed!
      \visible<9->{\\ Cycle}
    }
  \end{center}
\end{imageframe}


\begin{frame}
  \frametitle{Buffering}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      x\GETS0\SEMI
      y\GETS0\SEMI
      (
      x\GETS1\SEMI\aReg\GETS y
      \PAR
      y\GETS1\SEMI \aReg\GETS x)
      \\[-1.5ex]
      \hbox{\begin{tikzinline}[node distance=.9em]
          \event{wx0}{\DW{x}{0}}{}
          \event{wy0}{\DW{y}{0}}{right=of wx0}
          \event{wx}{\DW{x}{1}}{right=3em of wy0}
          \event{ry}{\DR{y}{0}}{right=of wx}
          \event{wy}{\DW{y}{1}}{right=3em of ry}
          \event{rx}{\DR{x}{0}}{right=of wy}
          % \wk[out=15,in=165]{wx0}{wx}
          % \wk[out=15,in=165]{wy0}{wy}
          \rf[out=15,in=165]{wy0}{ry}
          \rf[out=10,in=170]{wx0}{rx}
          \wk{ry}{wy}
          \wk[out=-165,in=-15]{rx}{wx}
          % \po{rx}{wy}
          % \pox{wy}[below]{rx}
          % \pox{wx}{ry}
        \end{tikzinline}}
      % \hbox{\begin{tikzinline}[node distance=1.5em and 2em]
      %   \event{wx0}{\DW{x}{0}}{}
      %   \event{wy0}{\DW{y}{0}}{below=of wx0}
      %   \event{wx}{\DW{x}{1}}{right=of wx0}
      %   \event{wy}{\DW{y}{1}}{right=of wy0}
      %   \event{ry}{\DR{y}{0}}{right=of wx}
      %   \event{rx}{\DR{x}{0}}{right=of wy}
      %   \wk{wx0}{wx}
      %   \wk{wy0}{wy}
      %   \rf{wy0}{ry}
      %   \rf{wx0}{rx}
      %   \wk[out=-150,in=15]{ry}{wy}
      %   \wk[out=150,in=-15]{rx}{wx}
      %     %   \po{rx}{wy}
      %     %   \pox{wy}[below]{rx}
      %     %   \pox{wx}{ry}
      % \end{tikzinline}}
    \end{gathered}
    \spacetag{SB\CMARK}
    \\[5ex]
    \begin{gathered}
      \aReg\GETS y\SEMI x\GETS1
      \PAR
      \aReg\GETS x\SEMI y\GETS1
      \\
      \hbox{\begin{tikzinline}[node distance=.9em]
          \event{ry}{\DR{y}{1}}{}
          \event{wx}{\DW{x}{1}}{right=of ry}
          \event{rx}{\DR{x}{1}}{right=3em of wx}
          \event{wy}{\DW{y}{1}}{right=of rx}
          \rf{wx}{rx}
          \rf[out=-165,in=-15]{wy}{ry}
          % \pox{rx}[below]{wy}
          % \pox{ry}{wx}
          % \po{rx}{wy}
        \end{tikzinline}}
      % \hbox{\begin{tikzinline}[node distance=1.5em and 2em]
      %   \event{ry}{\DR{y}{1}}{}
      %   \event{rx}{\DR{x}{1}}{below=of ry}
      %   \event{wx}{\DW{x}{1}}{right=of ry}
      %   \event{wy}{\DW{y}{1}}{right=of rx}
      %   \rf{wy}{ry}
      %   \rf{wx}{rx}
      %     %   \pox{rx}[below]{wy}
      %     %   \pox{ry}{wx}
      %     %   \po{rx}{wy}
      % \end{tikzinline}}
    \end{gathered}
    \spacetag{LB\CMARK}
  \end{gather*}
\end{frame}


\begin{frame}<2->
  \setbeamercovered{transparent=20}
  \frametitle{Synchronization and Fences}
  \begin{itemize}
  \item Let $\aPS'\in(\aForm \mid \aAct) \prefix \aPSS$ when
    $(\exists\aPS\in\aPSS)$
    $(\forall\aEv\in\Event)$
    \begin{enumerate}
    \item<1>[{\labeltextsc[P1]{(P1)}{1}}]
      $\Event' = \Event \cup \{\bEv\}$
    \item<1>[{\labeltextsc[P2]{(P2)}{2}}]
      ${\le'}\supseteq{\le}$
    \item<1>[{\labeltextsc[P3]{(P3a)}{3a}\labeltextsc[P3]{}{3}}]%
      $\labelingAct'(\aEv) = \labelingAct(\aEv)$
    \item<1>[{\labeltextsc[P3b]{(P3b)}{3b}}]
      $\labelingAct'(\bEv) = \aAct$
    \item<1>[{\labeltextsc[P4a]{(P4a)}{4a}\labeltextsc[P4]{}{4}}]%
      $\labelingForm'(\bEv)$ implies $\aForm\land(\bEv\not\in\Event\lor\labelingForm(\bEv))$
      % \\
      % if $\bEv\not\in\Event$ then $\labelingForm'(\bEv)$ implies
      % $\aForm$;
      % if $\bEv\in\Event$ then $\labelingForm'(\bEv)$ implies
      % $\aForm\lor\labelingForm(\bEv)$;
    \item<1>[{\labeltextsc[P4b]{(P4b)}{4b}}]
      if $\bEv\neq(\DR{..)}{}\mkern86mu$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$
    \item<1>[{\labeltextsc[P4c]{(P4c)}{4c}}]
      if $\bEv=(\DR{\aVal}{\aLoc})\mkern75mu$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)[\aVal/\aLoc]$
    \item<1>[{\labeltextsc[P5a]{(P5a)}{5a}\labeltextsc[P5]{}{5}}]%
      if $\bEv=(\DR{..)}{}$, $\aEv=(\DW{..)}{}$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$ or $\bEv\le'\aEv$
    \item<1>[{\labeltextsc[P5b]{(P5b)}{5b}}]
      if $\bEv$ and $\aEv$ are conflicting actions then $\bEv\le'\aEv$
    \item[{\labeltextsc[P5c]{(P5c)}{5c}}]
      if $\bEv$ is an acquire or $\aEv$ is a release then $\bEv \le' \aEv$
    \item[{\labeltextsc[P5d]{(P5d)}{5d}}]
      if $\bEv$ is an SC write and $\aEv$ is an SC read then $\bEv \le' \aEv$
    \item[{\labeltextsc[P5e]{(P5e)}{5e}}] if $\bEv$ reads, and $\aEv$ is an acquiring fence, then
      $\bEv \le' \aEv$
    \item[{\labeltextsc[P5f]{(P5f)}{5f}}] if $\bEv$ is a releasing fence, and $\aEv$ writes, then
      $\bEv \le' \aEv$
    \end{enumerate}
  \end{itemize}
\end{frame}


\begin{frame}
  \frametitle{Publication}
  \vspace{-1\baselineskip}
  \begin{gather}
    \begin{gathered}
      x\GETS0\SEMI %y\GETS0\SEMI
      x\GETS 1\SEMI y^\mRA\GETS1 \PAR r\GETS y^\mRA\SEMI s\GETS x
      \\
      \nonumber
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{wx0}{\DW{x}{0}}{}
          \event{wx1}{\DW{x}{1}}{right=of wx0}
          \event{wy1}{\DWRel{y}{1}}{right=of wx1}
          \event{ry1}{\DRAcq{y}{1}}{right=2.5em of wy1}
          \event{rx0}{\DR{x}{0}}{right=of ry1}
          \sync{wx1}{wy1}
          \sync{ry1}{rx0}
          \rf{wy1}{ry1}
          % \rf[out=10,in=170]{wx0}{rx0}
          \wk{wx0}{wx1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{PUB1\XMARK}
    \\[5ex]
    \begin{gathered}
      x\GETS0\SEMI %y\GETS0\SEMI
      x\GETS 1\SEMI \FENCE^\mREL\SEMI y \GETS1
      \PAR
      r\GETS y \SEMI \FENCE^\mACQ\SEMI s\GETS x
      \\
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{wx0}{\DW{x}{0}}{}
          \event{wx1}{\DW{x}{1}}{right=of wx0}
          \event{fr}{\DFS{\mREL}}{right=of wx1}
          \event{wy1}{\DW{y}{1}}{right=of fr}
          \event{ry1}{\DR{y}{1}}{right=2.5em of wy1}
          \event{fa}{\DFS{\mACQ}}{right=of ry1}
          \event{rx0}{\DR{x}{0}}{right=of fa}
          \sync{wx1}{fr}
          \sync{fr}{wy1}
          \sync{ry1}{fa}
          \sync{fa}{rx0}
          \rf{wy1}{ry1}
          %\rf[out=10,in=170]{wx0}{rx0}
          \wk{wx0}{wx1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{PUB2\XMARK}
  \end{gather}
\end{frame}

\begin{frame}
  \frametitle{SC Access/Fences}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      r\GETS y\SEMI x^\mSC\GETS1\SEMI s\GETS x
      \PAR
      % y\GETS0\SEMI
      x^\mSC\GETS2 \SEMI y\GETS1
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DR{y}{1}}{}
          \event{b}{\DW[\mSC]{x}{1}}{right=of a}
          \sync{a}{b}
          \event{bb}{\DR{x}{2}}{right=of b}
          \wk{b}{bb}
          % \event{c}{\DW{y}{0}}{right=2em of bb}
          % \event{d}{\DW[\mSC]{x}{2}}{right=of c}
          % \po{c}{d}
          \event{d}{\DW[\mSC]{x}{2}}{right=3em of bb}
          \event{e}{\DW{y}{1}}{right=of d}
          % \rf[out=170,in=10]{d}{bb}
          \rf{d}{bb}
          \rf[out=-170,in=-10]{e}{a}
          \wk[in=165,out=15]{b}{d}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{SC1\CMARK}
    \\[2ex]
    \begin{gathered}
      x^\mSC\GETS1 \SEMI r\GETS y^\mSC
      \PAR
      y^\mSC\GETS1 \SEMI y^\mSC\GETS2 \SEMI x\GETS2 \SEMI s\GETS x^\mSC
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DW[\mSC]{x}{1}}{}
          \event{b}{\DR[\mSC]{y}{1}}{right=of a}
          \event{c}{\DW[\mSC]{y}{1}}{right=3em of b}
          \event{d}{\DW[\mSC]{y}{2}}{right=of c}
          \event{e}{\DW{x}{2}}{right=of d}
          \event{f}{\DR[\mSC]{x}{1}}{right=of e}
          \sync{a}{b}
          \sync{c}{d}
          \sync[out=15,in=165]{d}{f}
          \rf{c}{b}
          \rf[out=-8,in=-172]{a}{f}
          \wk[in=10,out=170]{e}{a}
          \wk{e}{f}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{SC2\CMARK}
    \\[2ex]
    \begin{gathered}
      x\GETS1
      \PAR
      r\GETS x\SEMI   
      \FENCE^{\mSC}\SEMI
      r\GETS y  
      \PAR
      y\GETS 1 \SEMI
      \FENCE^{\mSC}\SEMI
      r\GETS x  
      \\[-.1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DW{x}{1}}{}
          \event{b1}{\DR{x}{1}}{right=3em of a1}
          \event{b2}{\DFS{\mSC}}{right=of b1}
          \sync{b1}{b2}
          \event{b3}{\DR{y}{0}}{right=of b2}
          \sync{b2}{b3}
          \event{c1}{\DW{y}{1}}{right=3em of b3}
          \event{c2}{\DFS{\mSC}}{right=of c1}
          \sync{c1}{c2}
          \event{c3}{\DR{x}{0}}{right=of c2}
          \sync{c2}{c3}
          \wk{b3}{c1}
          \rf{a1}{b1}
          \wk[out=-170,in=-10]{c3}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{SC3\XMARK}
    \\[2ex]
    \begin{gathered}
      x\GETS1\SEMI   
      z^\mRA\GETS1\SEMI   
      \PAR
      r^\mRA\GETS z\SEMI   
      \FENCE^{\mSC}\SEMI
      r\GETS y  
      \PAR
      y\GETS 1 \SEMI
      \FENCE^{\mSC}\SEMI
      r\GETS x  
      \\[-.1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DW{x}{1}}{}
          \event{a2}{\DWRel{z}{1}}{right=of a1}
          \sync{a1}{a2}
          \event{b1}{\DRAcq{z}{1}}{right=2em of a2}
          \event{b2}{\DFS{\mSC}}{right=of b1}
          \sync{b1}{b2}
          \event{b3}{\DR{y}{0}}{right=of b2}
          \sync{b2}{b3}
          \event{c1}{\DW{y}{1}}{right=2em of b3}
          \event{c2}{\DFS{\mSC}}{right=of c1}
          \sync{c1}{c2}
          \event{c3}{\DR{x}{0}}{right=of c2}
          \sync{c2}{c3}
          \wk{b3}{c1}
          \rf{a2}{b1}
          \wk[out=-170,in=-10]{c3}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{SC4\XMARK}
  \end{gather*}  
\end{frame}

\begin{frame}
  \frametitle{Coherence}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      x\GETS 1
      \PAR
      x\GETS2
      \PAR
      x\GETS 3
      \PAR
      x\GETS 4
      \PAR
      x\GETS 5
      \PAR
      r\GETS x\SEMI r\GETS x \SEMI r\GETS x \SEMI r\GETS x \SEMI r\GETS x
      \\
      \hbox{\begin{tikzinline}[node distance=.7em and 2em]
          \event{wx1}{\DW{x}{1}}{}
          \event{rx1a}{\DR{x}{1}}{above right=of wx1}
          \event{rx1b}{\DR{x}{1}}{above=of rx1a}
          \event{wx2}{\DW{x}{2}}{below right=of rx1a}
          \event{rx2a}{\DR{x}{2}}{above right=of wx2}
          \event{rx2b}{\DR{x}{2}}{above=of rx2a}
          \event{wx3}{\DW{x}{3}}{above right=of rx2a}            
          \event{wx4}{\DW{x}{4}}{right=of rx2a}
          \event{wx5}{\DW{x}{5}}{below right=of wx4}
          \event{rx5}{\DR{x}{5}}{above right=of wx5}
          \rf{wx1}{rx1a}
          \rf{wx1}{rx1b}
          \rf{wx2}{rx2a}
          \rf{wx2}{rx2b}
          \wk{rx1a}{wx2}
          \wk{rx1b}{wx2}
          \wk{rx2a}{wx3}
          \wk{rx2a}{wx4}
          \wk{rx2b}{wx3}
          \wk{rx2b}{wx4}
          \wk{wx3}{wx5}
          \wk{wx4}{wx5}
          \rf{wx5}{rx5}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{CO1\CMARK}
    \\[2ex]
    \begin{gathered}
      x\GETS1\SEMI x\GETS 2
      \PAR
      y\GETS x \SEMI z\GETS x
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DW{x}{1}}{}
          \event{b}{\DW{x}{2}}{right=of a}
          \wk{a}{b}
          \event{c}{\DR{x}{2}}{right=3em of b}
          \event{d}{\DW{y}{2}}{right=of c}
          \po{c}{d}
          \event{e}{\DR{x}{1}}{right=of d}
          \event{f}{\DW{z}{1}}{right=of e}
          \po{e}{f}
          \rf{b}{c}
          \rf[out=10,in=170]{a}{e}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{CO2\CMARK}
    \\[2ex]
    \begin{gathered}
      r\GETS x\SEMI x\GETS 1
      \PAR
      s\GETS x\SEMI x\GETS 2
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DR{x}{2}}{}
          \event{a2}{\DW{x}{1}}{right=of a1}
          \wk{a1}{a2}
          \event{b1}{\DR{x}{1}}{right=3em of a2}
          \event{b2}{\DW{x}{2}}{right=of b1}
          \wk{b1}{b2}
          \rf{a2}{b1}
          \rf[out=-165,in=-15]{b2}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{TC16\XMARK}
  \end{gather*}
\end{frame}

\begin{frame}
  \frametitle{Internal Reads}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      x\GETS 0 \SEMI
      (r\GETS x\SEMI\IF{r\geq0}\THEN y\GETS1 \FI
      \PAR
      x\GETS y)
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{wx0}{\DW{x}{0}}{}
          \event{rx1}{\DR{x}{1}}{right=3em of wx0}
          \event{wy1}{0\geq0\mid\DW{y}{1}}{right=of rx1}
          \event{ry1}{\DR{y}{1}}{right=3em of wy1}
          \event{wx1}{\DW{x}{1}}{right=of ry1}
          \po{ry1}{wx1}
          \rf[out=-168,in=-12]{wx1}{rx1}
          \rf{wy1}{ry1}
          \wk[out=10,in=170]{wx0}{wx1}
          \wk{wx0}{rx1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{TC1\CMARK}
    \\[3ex]
    \begin{gathered}
      x\GETS 0 \SEMI
      (r\GETS x\SEMI\IF{r\geq0}\THEN y\GETS1 \FI
      \PAR
      x\GETS y
      \PAR
      x\GETS {-2})
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{wx0}{\DW{x}{0}}{}
          \event{rx1}{\DR{x}{1}}{right=3em of wx0}
          \event{wy1}{0\geq0\mid\DW{y}{1}}{right=of rx1}
          \event{ry1}{\DR{y}{1}}{right=3em of wy1}
          \event{wx1}{\DW{x}{1}}{right=of ry1}
          \event{wx2}{\DW{x}{{-2}}}{right=3em of wx1}
          \po{ry1}{wx1}
          \rf[out=-168,in=-12]{wx1}{rx1}
          \rf{wy1}{ry1}
          \wk[out=10,in=170]{wx0}{wx1}
          \wk{wx0}{rx1}
          \wk{wx1}{wx2}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{TC9\CMARK}
    \\[3ex]
    \begin{gathered}
      r\GETS x\SEMI
      s\GETS x\SEMI
      \IF{r{=}s}\THEN y\GETS 1\FI
      \PAR
      x\GETS y
      \\[-1ex]
      \nonumber
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DR{x}{1}}{}
          \event{a2}{\DR{x}{1}}{right=of a1}
          \event{a3}{(x{=}x)\land(1{=}1)\mid\DW{y}{1}}{right=of a2}
          % \po{a2}{a3}
          % \po[out=15,in=165]{a1}{a3}
          \event{b1}{\DR{y}{1}}{right=3em of a3}
          \event{b2}{\DW{x}{1}}{right=of b1}
          \rf{a3}{b1}
          \po{b1}{b2}
          \rf[out=169,in=11]{b2}{a2}
          \rf[out=169,in=11]{b2}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{TC2\CMARK}
  \end{gather*}  
\end{frame}

\begin{frame}
  \frametitle{Internal Reads+Synchronization}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      x\GETS1 \SEMI
      a^\mRA\GETS1 \SEMI
      \IF{z^\mRA}\THEN  y\GETS x \FI
      \PAR
      \IF{a^\mRA}\THEN  x\GETS 2\SEMI z^\mRA\GETS1 \FI
      \\
      \hbox{\begin{tikzinline}[node distance=1.2em]
          \event{a1}{\DW{x}{1}}{}
          \event{a2}{\DWRel{a}{1}}{right=of a1}
          \sync{a1}{a2}
          \event{b3}{\DRAcq{a}{1}}{below right=0em and 1.2em of a2}
          % \event{b3}{\DRAcq{a}{1}}{right=3em of a2}
          \rf{a2}{b3}
          \event{b4}{\DW{x}{2}}{right=of b3}
          \sync{b3}{b4}
          \event{b5}{\DWRel{z}{1}}{right=of b4}
          \sync{b4}{b5}
          \event{a6}{\DRAcq{b}{1}}{above right=0em and 1.2em of b5}
          % \event{a6}{\DRAcq{z}{1}}{right=3em of b5}
          \rf{b5}{a6}
          \event{a7}{\DR{x}{1}}{right=of a6}
          \sync{a6}{a7}
          \event{a8}{1{=}1\mid\DW{y}{1}}{right=of a7}
          \graypo{a7}{a8}
          \sync[out=-18,in=-162]{a6}{a8}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{IN1\XMARK}
    \\[5ex]
    \begin{gathered}
      \aReg\GETS x\SEMI
      y^\mRA\GETS 1\SEMI
      \bReg\GETS y\SEMI
      z\GETS \bReg
      % z\GETS y
      \PAR
      x\GETS z
      \\[-1ex]
      \nonumber
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DR{x}{1}}{}
          \event{a2}{\DWRel{y}{1}}{right=of a1}
          \sync{a1}{a2}
          \event{a3}{\DR{y}{1}}{right=of a2}
          \event{a4}{1{=}1\mid\DW{z}{1}}{right=of a3}
          \rf{a2}{a3}
          % \po{a3}{a4}
          \event{b1}{\DR{z}{1}}{right=3em of a4}
          \event{b2}{\DW{x}{1}}{right=of b1}
          % \po[out=10,in=170]{a2}{a4}
          \po{b1}{b2}
          \rf{a4}{b1}
          \rf[out=170,in=10]{b2}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{IN2\CMARK}
  \end{gather*}
\end{frame}



\begin{frame}
  \frametitle{Local data race freedom}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      (x\GETS 1 \SEMI   y^\mRA \GETS 1)
      \PAR
      (x\GETS 2 \SEMI \FENCE^\mSC \SEMI \IF{y^\mRA}\THEN r\GETS x \SEMI s\GETS x\FI)
      \\
      \hbox{\begin{tikzinline}[node distance=1.2em]
          \event{wx1}{\DW{x}{1}}{}
          \event{wy1}{\DWRel{y}{1}}{right=of wx0}
          \sync{wx1}{wy1}
          \event{wx2}{\DW{x}{2}}{right=3em of wy1}
          \event{f}{\DFS{\mSC}}{right=of wx2}
          \sync{wx2}{f}
          \event{ry1}{\DR[\mRA]{y}{1}}{right=of f}
          \sync{f}{ry1}
          \event{rx1}{\DR{x}{1}}{right=3em of ry1}
          \event{rx2}{\DR{x}{2}}{right=of rx1}
          \sync{ry1}{rx1}
          \sync[out=15,in=165]{ry1}{rx2}
          \rf[out=10,in=170]{wy1}{ry1}
          \wk[out=10,in=170]{wx1}{wx2}
          \wk[out=-170,in=-10]{rx1}{wx2}
          \bgellipse[yellow!50]{(wy1)(f)}{}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{past\XMARK}
    \\[2ex]
    \begin{gathered}
      (r\GETS 1 \SEMI \REF{r}\GETS 42\SEMI s\GETS \REF{r}\SEMI  x^\mRA\GETS r)
      \PAR
      (r\GETS x \SEMI \REF{r}\GETS 7)
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.2em]
          \event{a1}{\DW{\REF{1}}{42}}{}
          \event{a2}{\DR{\REF{1}}{7}}{right=of a1}
          \wk{a1}{a2}
          % \event{a3}{\DFS{\mREL}}{right=of a2}
          % \sync{a2}{a3}
          \event{a4}{\DWRel{x}{1}}{right=of a2}
          \sync{a2}{a4}
          \event{b1}{\DR{x}{1}}{right=3em of a4}
          \event{b2}{\DW{\REF{1}}{7}}{right=of b1}
          \po{b1}{b2}
          \rf{a4}{b1}
          \wk[out=170,in=10]{b2}{a2}
          \bgoval[green!30]{(b1)(b2)}{}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{future\XMARK}
    % \\[2ex]
    % \spacetag{CO3}
    % \begin{gathered}
    %   x\GETS1\SEMI y^\mRA\GETS 1
    %   \PAR
    %   x\GETS2\SEMI z^\mRA\GETS 1
    %   \PAR
    %   r\GETS z^\mRA \SEMI 
    %   r\GETS y^\mRA \SEMI 
    %   r\GETS x \SEMI 
    %   r\GETS x
    %   \\[-1ex]
    %   \hbox{\begin{tikzinline}[node distance=1.5em]
    %     \event{a1}{\DW{x}{1}}{}
    %     \event{a2}{\DW[\mRA]{y}{1}}{right=of a1}
    %     \sync{a1}{a2}
    %     \event{b1}{\DW{x}{2}}{right=3em of a2}
    %     \event{b2}{\DW[\mRA]{\,z}{1}}{right=of b1}
    %     \sync{b1}{b2}
    %     \event{c1}{\DR[\mRA]{\,z}{1}}{right=3em of b2}
    %     \event{c2}{\DR[\mRA]{y}{1}}{right=of c1}
    %     \event{c3}{\DR{x}{2}}{right=of c2}
    %     \event{c4}{\DR{x}{1}}{right=of c3}
    %     \sync{c1}{c2}
    %     \sync{c2}{c3}
    %     \sync[out=20,in=160]{c2}{c4}
    %     \rf[out=8,in=172]{a2}{c2}
    %     \rf{b2}{c1}
    %     \wk[out=19,in=161]{a1}{b1}
    %     \wk[out=-172,in=-8]{c4}{b1}
    %   \end{tikzinline}}
    % \end{gathered}
  \end{gather*}
\end{frame}

\begin{frame}[label=x]
  \frametitle{Valid Transformations} %{\color{gray}\normalsize($^\star$ see paper)}}
  \vspace{-1\baselineskip}
  \begin{align*}
    % \tag{RR}
    \sem{\aReg \GETS \aLoc \SEMI \bReg  \GETS \bLoc\SEMI\aCmd} &=
    \sem{\bReg  \GETS \bLoc\SEMI \aReg \GETS \aLoc\SEMI\aCmd} &&\text{if } \aReg\neq\bReg
    \\
    % \tag{WW}
    \sem{\aLoc \GETS \aExp \SEMI \bLoc  \GETS \bExp\SEMI\aCmd} &=
    \sem{\bLoc  \GETS \bExp\SEMI \aLoc \GETS \aExp\SEMI\aCmd} &&\text{if } \aLoc\neq\bLoc
    \\
    % \tag{RW}
    \sem{\aLoc \GETS \aExp  \SEMI \bReg  \GETS \bLoc \SEMI\aCmd} &=
    \sem{\bReg  \GETS \bLoc \SEMI\aLoc \GETS \aExp\SEMI\aCmd} &&\text{if }
    \aLoc\neq\bLoc \textAnd \bReg\not\in\free(\aExp)%\disjoint{{\free(\aLoc \GETS \aExp)}}{{\free(\bReg  \GETS \bLoc)}}
    \\
    % \tag{roach1}
    \sem{x^\amode \GETS \aExp \SEMI\bReg \GETS y \SEMI\aCmd} &\supseteq
    \sem{\bReg \GETS y  \SEMI x^\amode\GETS \aExp \SEMI \aCmd} 
    &&\text{if }
    \aLoc\neq\bLoc \textAnd \bReg\not\in\free(\aExp)%\disjoint{{\free(\aLoc \GETS \aExp)}}{{\free(\bReg  \GETS \bLoc)}}
    \\
    % \tag{roach2}
    \sem{x \GETS \aExp \SEMI\bReg \GETS y^\amode \SEMI\aCmd} &\supseteq
    \sem{\bReg \GETS y^\amode  \SEMI x\GETS \aExp \SEMI \aCmd} 
    &&\text{if }
    \aLoc\neq\bLoc \textAnd \bReg\not\in\free(\aExp)%\disjoint{{\free(\aLoc \GETS \aExp)}}{{\free(\bReg  \GETS \bLoc)}}
    \\
    % \tag{RF}
    \sem{\FENCE^\amode \SEMI \FENCE^\amode\SEMI\aCmd} &\supseteq 
    \sem{\FENCE^\amode \SEMI \bReg  \GETS \aReg\SEMI\aCmd}
    \\
    % \tag{RL}
    \sem{\aReg \GETS \aLoc^\amode \SEMI \bReg  \GETS \aLoc^\amode\SEMI\aCmd} &\supseteq 
    \sem{\aReg \GETS \aLoc^\amode \SEMI \bReg  \GETS \aReg\SEMI\aCmd}
    \\
    % \tag{CSE}
    \sem{r_1\GETS \aLoc \SEMI
      s\GETS \bLoc \SEMI  
      r_2\GETS \aLoc\SEMI\aCmd}
    &\supseteq
    \sem{r_1\GETS \aLoc \SEMI     
      r_2\GETS r_1\SEMI
      s\GETS \bLoc \SEMI\aCmd}
    &&\textif \aReg_2\neq\bReg
  \end{align*}  
  \vspace{-1\baselineskip}  
  \begin{itemize}\itemsep=0pt\parskip=0pt
  \item Reordering: W $\leftrightarrow$ W,  R $\leftrightarrow$ R,  W $\leftrightarrow$ R 
  \item Roach motel: Relaxed $\leftarrow$ Acquire,  Relaxed $\rightarrow$ Release 
  \item Elimination: Redundant fence, Redundant read, Common Subexpression %,  Irrelevant read$^\star$ (see paper)
  \end{itemize}
\end{frame}

\begin{frame}[label=y]
  \frametitle{Valid Transformations}
  \vspace{-1\baselineskip}
  \begin{align*}
    % \tag{SE}
    \sem{\aCmd\PAR \VAR\aLoc\SEMI\bCmd} &=
    \sem{\VAR\aLoc\SEMI(\aCmd\PAR\bCmd)}
    &&\text{ if } \aLoc\not\in\free(\aCmd)
    \\
    % \tag{CL} 
    \sem{\IF{\aExp}\THEN\aCmd\ELSE\aCmd\FI} &\supseteq
    \sem{\aCmd}
    \\
    % \tag{CA} 
    \sem{\IF{\aExp}\THEN\aCmd\ELSE\aCmd\FI} &\subseteq^{\makebox[0em]{$\scriptstyle\star$}}
    \sem{\aCmd}
    \\
    % \tag{DC}
    \sem{\IF{\aExp}\THEN\aCmd\ELSE\bCmd\FI} &=
    \sem{\aCmd}
    &&\textif \aExp \text{ is a tautology}
    \\
    % \tag{DS}
    \sem{\aLoc \GETS \aExp \SEMI \aLoc  \GETS \bExp\SEMI\aCmd} &\supseteq^{\makebox[0em]{$\scriptstyle\star$}}
    \sem{\aLoc \GETS \bExp\SEMI\aCmd}    
    \\
    % \tag{SF}
    \sem{\aLoc^\amode \GETS \aExp \SEMI \aReg  \GETS \aLoc\SEMI\aCmd} &\supseteq^{\makebox[0em]{$\scriptstyle\star$}}
    \sem{\aLoc^\amode \GETS \aExp \SEMI \aReg  \GETS \aExp\SEMI\aCmd}  
    \\
    % \tag{RE}
    \sem{\aReg  \GETS \aLoc\SEMI\aCmd} & \supseteq^{\makebox[0em]{$\scriptstyle\star$}}
    \sem{\aCmd}  
    &&\textif \aReg\not\in\free(\aCmd)&&\hbox{}
  \end{align*}  
  \vspace{-1\baselineskip}  
  \begin{itemize}\itemsep=0pt\parskip=0pt
  \item Scope extrusion
  \item Code lifting, Case analysis$^\star$ ($^\star$See paper)
  \item Elimination: Dead code, Dead store$^\star$, Store forwarding$^\star$, Irrelevant read$^\star$
  \end{itemize}
\end{frame}

\begin{comment}
  \frametitle{Valid Transformations (with a little more work)}
  \vspace{-1\baselineskip}
  \begin{align*}
    % \tag{RE}
    \sem{\aReg  \GETS \aLoc\SEMI\aCmd} & \supseteq
    \sem{\aCmd}  
    &&\textif \aReg\not\in\free(\aCmd)&&\hbox{}
    \\
    % \tag{SF}
    \sem{\aLoc^\amode \GETS \aExp \SEMI \aReg  \GETS \aLoc\SEMI\aCmd} &\supseteq 
    \sem{\aLoc^\amode \GETS \aExp \SEMI \aReg  \GETS \aExp\SEMI\aCmd}  
    \\
    % \tag{DS}
    \sem{\aLoc \GETS \aExp \SEMI \aLoc  \GETS \bExp\SEMI\aCmd} &\supseteq 
    \sem{\aLoc \GETS \bExp\SEMI\aCmd}    
    \\
    % \tag{RI}
    \readc\sem{\aCmd} & \supseteq
    \readc\sem{\aReg  \GETS \aLoc\SEMI\aCmd}  
    &&\textif \aReg\not\in\free(\aCmd)&&\hbox{}  
  \end{align*}
  \begin{itemize}\itemsep=0pt\parskip=0pt
  \item Irrelevant read elimination
  \item Store forwarding
  \item Dead store elimination
    % \item Irrelevant read introduction
  \end{itemize}
\end{comment}

\begin{frame}[label=z]
  \frametitle{Other Transformations}
  \begin{itemize}
  \item Valid$\cmark{}$ Proof$\xmark{}$
    \begin{itemize}
    \item Redundant write after read elimination
    \end{itemize}
  \item Sound observationally$\cmark{}$ Valid$\xmark{}$
    \begin{itemize}      
    \item Access mode strengthening $(\mRLX\rightarrow\mRA \rightarrow\mSC)$
    \item Commuting/Eliminating some synchronizations
    \item Implementing synchronizations using fences
    \item Implementing locks using synchronizations
    \end{itemize}
  \item Sound observationally$\qmark{}$ Valid$\xmark{}$
    \begin{itemize}      
    \item Access mode weakening, eg $(\mSC\rightarrow \mRA\rightarrow\mRLX)$
    \item Lock elision
    \end{itemize}
  \item Sound observationally$\xmark{}$
    \begin{itemize}
    \item Thread inlining
    \item Relevant read introduction
    \item Write introduction    
    \end{itemize}
  \end{itemize}
\end{frame}



\begin{frame}
  \frametitle{Other results and limitations}
  \begin{itemize}
  \item Results
    \begin{itemize}
    \item Compositional proof rule for PLTL
    \item Efficient ARM implementation
    \item Local data race freedom
    \end{itemize}
  \item<2-> Limitations
    \begin{itemize}
    \item No: loops or functions, sequential composition
    \item No: mixed size access, separate address dependencies
    \item Limited: optimizations, logic for OOTA
    \item<3-> MCA: ARM\cmark{} x86-64\cmark{} RISC-V\cmark{} POWER\xmark{}
      \only<4->{\begin{itemize}
        \item Add per-location partial order: $\leloc$ 
        \item Require \emph{observation:} if $\bEv$/$\aEv$ conflict and $\bEv\le\aEv$ then $\bEv\leloc\aEv$
        \item Prefixing (p5b): if $\aEv$ conflicts then $\bEv\leloc'\aEv$
        \item Fulfillment (f4): if $\cEv$ conflicts then $\cEv \leloc \bEv$ or $\aEv \leloc \cEv$        
        \end{itemize}}
    \end{itemize}
  \end{itemize}    
\end{frame}

\imagepage{images/keynote-images/keynote-images.008.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.021.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.022.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.023.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.011.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.012.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.013.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.009.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

\imagepage{images/keynote-images/keynote-images.017.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

\begin{frame}[label=nonmca]
  \frametitle{Non-MCA Architectures?}
  \begin{itemize}
  \item Two partial orders:
    \begin{itemize}
    \item[${\le}$] causal order, as before
    \item[${\leloc}$] per-location order
    \end{itemize}
  \item Require: $\bEv\leloc\aEv$ when $\bEv\le\aEv$ and they conflict
    (same location)
  \item 
    When prefixing $\bEv$ in front of $\aEv$:
    \begin{description}
    \item[{\labeltextsc[P5b]{(P5b)}{5b}}] if $\bEv$ and $\aEv$ conflict then
      \hl{$\bEv\leloc'\aEv$}
    \end{description}
  \item 
    When $\bEv$ \emph{fulfills $\aEv$}:
    \begin{description}
    \item[{\labeltextsc[F4]{(F4)}{rf4}}] for every conflicting write $\cEv$,
      either \hl{$\cEv \leloc \bEv$ or $\aEv \leloc \cEv$}
    \end{description}
  \item Example:
    \vspace{-1.7\baselineskip}
    \begin{gather*}
      r\GETS x\SEMI x\GETS 1
      \PAR
      y\GETS x 
      \PAR
      x\GETS y 
      \\
      \hbox{\begin{tikzinlinesmall}[node distance=1.5em]
          \event{a}{\DR{x}{1}}{}
          \event{b}{d:\DW{x}{1}}{right=of a}
          \event{c}{\DR{x}{1}}{right=3em of b}
          \event{d}{\DW{y}{1}}{right=of c}
          \po{c}{d}
          \event{e}{\DR{y}{1}}{right=3em of d}
          \event{f}{e:\DW{x}{1}}{right=of e}
          \po{e}{f}
          \rf{b}{c}
          \rf{d}{e}
          \rf[out=172,in=8]{f}{a}
        \end{tikzinlinesmall}}
      \tag{$\le$}
      \\
      \hbox{\begin{tikzinlinesmall}[node distance=1.5em]
          \event{a}{\DR{x}{1}}{}
          \event{b}{d:\DW{x}{1}}{right=of a}
          \wk{a}{b}
          \event{c}{\DR{x}{1}}{right=3em of b}
          \event{d}{\DW{y}{1}}{right=of c}
          \event{e}{\DR{y}{1}}{right=3em of d}
          \event{f}{e:\DW{x}{1}}{right=of e}
          \rf{b}{c}
          \rf{d}{e}
          \rf[out=172,in=8]{f}{a}
        \end{tikzinlinesmall}}
      \tag{$\leloc$}
    \end{gather*}  
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{LDRF: Reads from the Past}
  \vspace{-1\baselineskip}
  \begin{gather*}
    x\GETS 0 \SEMI y\GETS 0 \SEMI  (x \GETS 1  \SEMI y \GETS 1
    \PAR
    \IF{y}\THEN \aReg \GETS x \FI)
    \\[-.5ex]
    \hbox{\begin{tikzinline}[node distance=1.5em and 2em]
        \event{wy0}{\DW{y}{0}}{}
        \event{wx0}{\DW{x}{0}}{below=of wy0}
        \event{wx1}{\DW{x}{1}}{right=3em of wy0}
        \event{wy1}{\DW{y}{1}}{right=of wx1}
        \event{ry1}{\DR{y}{1}}{below=of wx1}
        \event{rx}{\DR{x}{0}}{below=of wy1}
        \rf[bend right]{wx0}{rx}
        \rf{wy1}{ry1}
        \wk[bend left]{wy0}{wy1}
        \pox{wx1}{wy1}
        \pox{ry1}[below]{rx}
        \wk{rx}{wx1}
        \node(ix)[left=of wx0]{};
        \node(iy)[left=of wy0]{};
        \bgoval[yellow!50]{(ix)(iy)}{P}
        \bgoval[pink!50]{(wx0)(wy0)}{P'\setminus P}
        \bgoval[green!10]{(ry1)(wx1)(rx)(wy1)}{P''\setminus P'}
        \pox{wx0}{wy0}
        \pox{wy0}{wx1}
        \pox{wy0}[below]{ry1}
      \end{tikzinline}}
    \qquad
    \hbox{\begin{tikzinline}[node distance=1.5em and 2em]
        \event{wy0}{\DW{y}{0}}{}
        \event{wx0}{\DW{x}{0}}{below=of wy0}
        \event{wx1}{\DW{x}{1}}{right=3em of wy0}
        \event{wy1}{\DW{y}{1}}{right=of wx1}
        \event{ry1}{\DR{y}{1}}{below=of wx1}
        \event{rx}{\DR{x}{1}}{below=of wy1}
        \rf{wx1}{rx}
        \rf{wy1}{ry1}
        \wk[bend left]{wy0}{wy1}
        \pox{wx1}{wy1}
        \pox{ry1}[below]{rx}
        \wk{wx0}{wx1}
        \node(ix)[left=of wx0]{};
        \node(iy)[left=of wy0]{};
        \bgoval[yellow!50]{(ix)(iy)}{P}
        \bgoval[pink!50]{(wx0)(wy0)}{P'\setminus P}
        \bgoval[green!10]{(ry1)(wx1)(rx)(wy1)}{P'''\setminus P'}
        \pox{wx0}{wy0}
        \pox{wy0}{wx1}
        \pox{wy0}[below]{ry1}
      \end{tikzinline}}
  \end{gather*}
\end{frame}
\begin{frame}
  \frametitle{LDRF: Reads from the Future}
  \vspace{-1\baselineskip}
  \begin{gather*}
    x\GETS 0 \SEMI y\GETS 0 \SEMI (\aReg \GETS x  \SEMI y \GETS 1
    \PAR
    \bReg \GETS y \SEMI x \GETS \bReg)
    \\[-.5ex]
    \hbox{\begin{tikzinline}[node distance=1.5em and 2em]
        \event{wx0}{\DW{y}{0}}{}
        \event{ry}{\DR{x}{1}}{right=3em of wx0}
        \event{wx1}{\DW{y}{1}}{right=of ry}
        \event{wy0}{\DW{x}{0}}{below=of wx0}
        \event{rx1}{\DR{y}{1}}{right=3em of wy0}
        \event{wy1}{\DW{x}{1}}{right=of rx1}
        \rf{wx1}{rx1}
        \rf{wy1}{ry}
        \po{rx1}{wy1}
        \pox{ry}{wx1}
        \wk[bend left]{wx0}{wx1}
        \wk[bend right]{wy0}{wy1}
        % \wk{wx0}{rx1}
        % \wk{wy0}{ry}
        \node(ix)[left=of wx0]{};
        \node(iy)[left=of wy0]{};
        \bgoval[yellow!50]{(ix)(iy)}{P}
        \bgoval[pink!50]{(wx0)(wy0)}{P'\setminus P}
        \bgoval[green!10]{(ry)(wx1)(rx1)(wy1)}{P''\setminus P'}
        \pox{wy0}{wx0}
        \pox{wx0}{ry}
        \pox{wx0}[below]{rx1}
      \end{tikzinline}}
    \qquad
    \hbox{\begin{tikzinline}[node distance=1.5em and 2em]
        \event{wx0}{\DW{y}{0}}{}
        \event{ry}{\DR{x}{0}}{right=3em of wx0}
        \event{wx1}{\DW{y}{1}}{right=of ry}
        \event{wy0}{\DW{x}{0}}{below=of wx0}
        \event{rx1}{\DR{y}{1}}{right=3em of wy0}
        \event{wy1}{\DW{x}{1}}{right=of rx1}
        \pox{ry}{wx1}
        \wk[bend left]{wx0}{wx1}
        \rf{wx1}{rx1}
        \rf{wy0}{ry}
        \po{rx1}{wy1}
        \wk{ry}{wy1}
        \node(ix)[left=of wx0]{};
        \node(iy)[left=of wy0]{};
        \bgoval[yellow!50]{(ix)(iy)}{P}
        \bgoval[pink!50]{(wx0)(wy0)}{P'\setminus P}
        \bgoval[green!10]{(ry)(wx1)(rx1)(wy1)}{P'''\setminus P'}
        \pox{wy0}{wx0}
        \pox{wx0}{ry}
        \pox{wx0}[below]{rx1}
      \end{tikzinline}}
  \end{gather*}
\end{frame}


\begin{frame}
  \frametitle{More OOTA}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      ( y\GETS x+1
      \PAR
      x\GETS y )
      \\[1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{rx}{\DR{x}{1}}{}
          \event{wy}{\DW{y}{2}}{right=of rx}
          \po{rx}{wy}
          \event{ry}{\DR{y}{1}}{right=3em of wy}
          \event{wx}{\DW{x}{1}}{right=of ry}
          \po{ry}{wx}
          % \rf{wy}{ry}
          \rf[out=170,in=10]{wx}{rx}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{OOTA6\XMARK}
    \\[2ex]
    \begin{gathered}
      x\GETS 2\SEMI
      \IF{x\NOTEQ2}\THEN y\GETS 1 \FI
      \PAR
      x\GETS 1\SEMI
      r\GETS x\SEMI
      \IF{y}\THEN x\GETS 3 \FI
      \\\nonumber
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{wx2}{\DW{x}{2}}{}
          \event{rx3}{\DR{x}{3}}{right=of wx2}
          \event{wy1}{\DW{y}{1}}{right=of rx3}
          \po{rx3}{wy1}
          \event{wx1}{\DW{x}{1}}{right=2em of wy1}
          \event{rx2}{\DR{x}{2}}{right=of wx1}
          \wk{wx1}{rx2}
          \event{ry1}{\DR{y}{1}}{right=of rx2}
          \event{wx3}{\DW{x}{3}}{right=of ry1}
          \po{ry1}{wx3}
          \wk[in=165,out=15]{rx2}{wx3}
          \rf[in=-170,out=-10]{wy1}{ry1}
          \rf[in=170,out=10]{wx2}{rx2}
          \rf[out=-170,in=-10]{wx3}{rx3}
          \wk[out=-170,in=-10]{wx1}{wx2}
          \wk{wx2}{rx3}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{OOTA7\XMARK}
  \end{gather*}
\end{frame}

\begin{frame}[label=b]
  \frametitle{Blockers}
  \notagparens{}
  \vspace{-1\baselineskip}
  \begin{gather*}
      \VAR x\SEMI (x\GETS 1 \SEMI y_1^\mRA\GETS1
      \PAR
      \IF{z_1}\THEN x\GETS2\FI\SEMI y_2^\mRA\GETS1
      \PAR
      r\GETS z_2^\mRA\SEMI s\GETS x)
      \\[-.5ex]
      \tag{\XMARK}
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DW{x}{1}}{}
          \event{b}{\DW[\mRA]{y_1}{1}}{right=of a}
          \event{c}{\DR{z_1}{1}}{right=1.8em of b}
          \event{d}{\DW{x}{2}}{right=of c}
          \event{e}{\DW[\mRA]{y_2}{1}}{right=of d}
          \event{f}{\DR[\mRA]{z_2}{1}}{right=1.8em of e}
          \event{g}{\DR{x}{1}}{right=of f}
          \sync{a}{b}
          \po{c}{d}
          \sync{d}{e}
          \sync{f}{g}
          \rf[out=8,in=172]{a}{g}
        \end{tikzinline}}
  \end{gather*}
  Context \begin{math}
    z_1\GETS y_1
    \PAR
    z_2\GETS y_2
    \PAR
    \hole{}
  \end{math}
  \begin{gather*}
    \tag{\XMARK}
    \hbox{\begin{tikzinline}[node distance=1.5em]
        \event{a}{\DW{x}{1}}{}
        \event{b}{\DW[\mRA]{y_1}{1}}{right=of a}
        \event{w}{\DR{y_1}{1}}{below=1.8em of b}
        \event{x}{\DW{z_1}{1}}{right=of w}
        \event{c}{\DR{z_1}{1}}{above=1.8em of x}
        \event{d}{\DW{x}{2}}{right=of c}
        \event{e}{\DW[\mRA]{y_2}{1}}{right=of d}
        \event{y}{\DR{y_2}{1}}{below=1.8em of e}
        \event{z}{\DW{z_2}{1}}{right=of y}
        \event{f}{\DR[\mRA]{z_2}{1}}{above=1.8em of z}
        \event{g}{\DR{x}{1}}{right=of f}
        \sync{a}{b}
        \po{c}{d}
        \sync{d}{e}
        \sync{f}{g}
        \po{w}{x}
        \rf{b}{w}
        \rf{x}{c}
        \po{y}{z}
        \rf{e}{y}
        \rf{z}{f}
      \end{tikzinline}}
  \end{gather*}
\end{frame}


\begin{frame}[label=rmw]
  \frametitle{RMWs}
  \begin{itemize}
  \item[] ${\xrmw}\subseteq{\le}$:
    \renewcommand{\bEv}{(\DR{x}{2})}
    \renewcommand{\aEv}{(\DW{x}{3})}
    \renewcommand{\cEv}{\alert{(\DW{x}{1})}}
    \renewcommand{\dEv}{\alert{(\DW{x}{3})}}
    \begin{itemize}
    \item If $\bEv \xrmw \aEv$ and $\cEv\gtN \aEv$ then  $\cEv\gtN \bEv$
    \item If $\bEv \xrmw \aEv$ and $\bEv\gtN \dEv$ then  $\aEv\gtN \dEv$
    \item ${\xrmw}$ does not coalesce in $\!\PAR\!$ or prefixing
    \end{itemize}
  \end{itemize}
  \vspace{-.5\baselineskip}
  \begin{gather*}
    \begin{gathered}
      x\GETS 0 \SEMI \bigl(\FADD^{\mRLX,\mRLX}(x,1) \PAR \FADD^{\mRLX,\mRLX}(x,1)\bigr)
      \\
      \hbox{\begin{tikzinline}[node distance=2em]
          \event{a0}{\DW{x}{0}}{}
          \event{a1}{\DR{x}{0}}{right=3em of a0}
          \event{a2}{\DW{x}{1}}{right=of a1}
          \event{b1}{\DR{x}{0}}{right=3em of a2}
          \event{b2}{\DW{x}{1}}{right=of b1}
          \rmw{a1}{a2}
          \rf{a0}{a1}
          \rf[out=-15,in=-165]{a0}{b1}
          \wk[out=-15,in=-165]{a1}{b2}
          \wk{b1}{a2}
          \graywk[bend left]{a2}{b1}
          \rmw{b1}{b2}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{RMW0\XMARK}
    \\[1ex]
    \begin{gathered}
      \aLoc\GETS0\SEMI\bReg\GETS \FADD^{\mRLX,\mRLX}(\aLoc,1)
      \PAR
      x\GETS 2\SEMI s\GETS x
      \\
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a2}{\DR{x}{0}}{}
          \event{a1}{\DW{x}{0}}{left=of a2}
          \rf{a1}{a2}
          \event{a3}{\DW{x}{2}}{right=of a2}
          \wk{a2}{a3}
          \event{b2}{\DW{x}{1}}{right=of a3}
          \event{b3}{\DR{x}{1}}{right=of b2}
          \rmw[out=-15,in=-165]{a2}[below]{b2}
          \wk{a3}{b2}
          \rf{b2}{b3}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{RMW1\XMARK}
    \\[1ex]
    \begin{gathered}
      r \GETS y\SEMI
      z \GETS r
      \PAR
      r\GETS z\SEMI
      x\GETS 0\SEMI
      s\GETS \FADD^{\mRLX,\mRA}(x,1) \SEMI
      y\GETS s{+}1
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DR{y}{1}}{}
          \event{a2}{\DW{z}{1}}{right=of a1}
          \po{a1}{a2}
          \event{b1}{\DR{z}{1}}{right=3em of a2}
          \rf{a2}{b1}
          \event{b2}{\DW{x}{0}}{right=of b1}
          \event{b3}{\DR{x}{0}}{right=of b2}
          \rf{b2}{b3}
          \event{b4}{\DWRel{x}{1}}{right=2em of b3}
          \rmw{b3}{b4}
          \event{b5}{\DW{y}{1}}{right=of b4}
          \sync[out=-15,in=-165]{b1}{b4}
          \po[out=-20,in=-160]{b3}{b5}
          \rf[out=170,in=10]{b5}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{RMW2\CMARK}
  \end{gather*}
\end{frame}

\begin{frame}[label=ps2]
  \frametitle{PS2.0 Examples}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      r\GETS \FADD^{\mRA,\mRA}(x,1)\SEMI \IF{r{=}0}\THEN y\GETS 1 \FI
      \PAR
      r\GETS \FADD^{\mRA,\mRA}(x,1)\SEMI \IF{r{=}0}\THEN \IF{y}\THEN x\GETS 0 \FI \FI
      \\
      \hbox{\begin{tikzinline}[node distance=2em]
          \event{a1}{\DR[\mRA]{x}{0}}{}
          \event{a1b}{\DW[\mRA]{x}{1}}{below=1em of a1}
          \event{a2}{\DW{y}{1}}{right=of a1}
          \event{b0}{\DR[\mRA]{x}{0}}{right=3em of a2}
          \event{b0b}{\DW[\mRA]{x}{1}}{below=1em of b0}
          \event{b1}{\DR{y}{1}}{right=of b0}
          \event{b2}{\DW{x}{0}}{right=of b1}
          \rmw{a1}{a1b}
          \rmw{b0}{b0b}
          \rf[out=-13,in=-163]{a2}{b1}
          \po{a1}{a2}
          \sync{b0}{b1}
          \po{b1}{b2}
          \rf[out=-165,in=-12]{b2}{a1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{CDRF\XMARK}
    \\
    \begin{gathered}
      x\GETS0 \SEMI
      \bigl(
        r\GETS \CAS^{\mRLX,\mRLX}(x,0,1)\SEMI \IF{r{<}10}\THEN y\GETS 1 \FI
        \PAR
        x\GETS{42}\SEMI x\GETS y
      \bigr)
      \\
      \hbox{\begin{tikzinline}[node distance=2em]
          \event{a0}{\DW{x}{0}}{}
          \event{a1}{\DR{x}{1}}{right=3em of a0}
          \event{a2}{0{<}10\mid\DW{y}{1}}{right=of a1}
          \event{b0}{\DW{x}{42}}{right=3em of a2}
          \event{b1}{\DR{y}{1}}{right=of b0}
          \event{b2}{\DW{x}{1}}{right=of b1}
          %\rmw{a1}{a2}
          \rf[out=-15,in=-160]{a2}{b1}
          \po{b1}{b2}
          \rf[out=-165,in=-15]{b2}{a1}
          \wk[out=10,in=170]{a0}{b0}
          \wk[out=15,in=165]{b0}{b2}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{GA+E\CMARK}
    \\
    \begin{gathered}
      r\GETS x\SEMI
      s\GETS \FADD^{\mRLX,\mRLX}(z,r)\SEMI y\GETS s{+}1
      \PAR
      x\GETS y
      \\
      \hbox{\begin{tikzinline}[node distance=2em]
          \event{a0}{\DR{x}{1}}{}
          \event{a1}{\DR{z}{0}}{right=of a0}
          \event{a1b}{\DW{z}{1}}{right=of a1}
          \event{a2}{\DW{y}{1}}{right=of a1b}
          \event{b0}{\DR{y}{1}}{right=3em of a2}
          \event{b1}{\DW{x}{1}}{right=of b0}
          \rmw{a1}{a1b}
          \po[out=20,in=160]{a0}{a1b}
          \po[out=20,in=160]{a1}{a2}
          \po{b0}{b1}
          \rf{a2}{b0}
          \rf[out=-165,in=-15]{b1}{a0}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{RP\CMARK}
  \end{gather*}
\end{frame}

\begin{frame}[label=mca]
  \frametitle{MCA Examples}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      \IF{z}\THEN x\GETS0 \FI \SEMI x\GETS1
      {\PAR}
      \IF{x}\THEN y\GETS0 \FI \SEMI y\GETS1
      {\PAR}
      \IF{y}\THEN z\GETS0 \FI \SEMI z\GETS1
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DR{z}{1}}{}
          \event{a2}{\DW{x}{0}}{right=of a1}
          \po{a1}{a2}
          \event{a3}{\DW{x}{1}}{right=of a2}
          \wk{a2}{a3}
          \event{b1}{\DR{x}{1}}{right=3em of a3}
          \event{b2}{\DW{y}{0}}{right=of b1}
          \po{b1}{b2}
          \event{b3}{\DW{y}{1}}{right=of b2}
          \wk{b2}{b3}
          \event{c1}{\DR{y}{1}}{right=3em of b3}
          \event{c2}{\DW{z}{0}}{right=of c1}
          \po{c1}{c2}
          \event{c3}{\DW{z}{1}}{right=of c2}
          \wk{c2}{c3}
          \rf{a3}{b1}
          \rf{b3}{c1}
          \rf[out=173,in=7]{c3}{a1}  
        \end{tikzinline}}
    \end{gathered}
    \spacetag{MCA1\XMARK}
    \\[1ex]
    \begin{gathered}
      x\GETS0\SEMI x\GETS 1
      \PAR
      y\GETS x
      \PAR
      r\GETS y^\mRA \SEMI s\GETS x
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{wx0}{\DW{x}{0}}{}
          \event{wx1}{\DW{x}{1}}{right=of wx0}
          \wk{wx0}{wx1}
          \event{rx1}{\DR{x}{1}}{right=3em of wx1}
          \event{wy1}{\DW{y}{1}}{right=of rx1}
          \po{rx1}{wy1}
          \event{ry1}{\DRAcq{y}{1}}{right=3em of wy1}
          \event{rx0}{\DR{x}{0}}{right=of ry1}
          \rf{wx1}{rx1}
          \rf{wy1}{ry1}
          \sync{ry1}{rx0}
          \wk[out=170,in=10]{rx0}{wx1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{MCA2\XMARK}
    \\[1ex]
    \begin{gathered}
      r\GETS x\SEMI x\GETS 1
      \PAR
      y\GETS x 
      \PAR
      x\GETS y 
      \\[-1.2ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a}{\DR{x}{1}}{}
          \event{b}{d:\DW{x}{1}}{right=of a}
          \wk{a}{b}
          \event{c}{\DR{x}{1}}{right=3em of b}
          \event{d}{\DW{y}{1}}{right=of c}
          \po{c}{d}
          \event{e}{\DR{y}{1}}{right=3em of d}
          \event{f}{e:\DW{x}{1}}{right=of e}
          \po{e}{f}
          \rf{b}{c}
          \rf{d}{e}
          \rf[out=172,in=8]{f}{a}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{MCA3\XMARK}
  \end{gather*}  
\end{frame}

\begin{frame}[label=addr]
  \frametitle{Address Calculation Examples}
  \vspace{-1\baselineskip}
  \begin{gather*}
    \begin{gathered}
      \aReg\GETS y\SEMI \bReg\GETS \REF{\aReg}\SEMI x\GETS \bReg
      \PAR
      \aReg\GETS x\SEMI \bReg\GETS \REF{\aReg}\SEMI y\GETS \bReg
      % x\GETS\REF{y} \PAR y\GETS\REF{x}
      \\
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DR{y}{2}}{}
          \event{a2}{\DR{\REF{2}}{1}}{right=of a1}
          \event{a3}{\DW{x}{1}}{right=of a2}
          \po{a2}{a3}
          \po[out=10,in=170]{a1}{a3}
          \event{b1}{\DR{x}{1}}{right=3em of a3}
          \event{b2}{\DR{\REF{1}}{2}}{right=of b1}
          \event{b3}{\DW{y}{2}}{right=of b2}
          \po{b2}{b3}
          \po[out=10,in=170]{b1}{b3}
          \rf[out=-170,in=-10]{b3}{a1}
          \rf{a3}{b1}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{ADDR1\XMARK}
    \\[1ex]
    \begin{gathered}
      (r\GETS 1 \SEMI \REF{r}\GETS 0 \SEMI \REF{r}\GETS 1\SEMI  x^\mRA\GETS r)
      \PAR
      (r\GETS x^\mRA \SEMI s \GETS \REF{r})
      \\[-1ex]
      \hbox{\begin{tikzinline}[node distance=1.5em]
          \event{a1}{\DW{\REF{1}}{0}}{}
          \event{a2}{\DW{\REF{1}}{1}}{right=of a1}
          \wk{a1}{a2}
          \event{a4}{\DWRel{x}{1}}{right=of a2}
          \sync{a2}{a4}
          \event{b1}{\DR[\mRA]{x}{1}}{right=3em of a4}
          \event{b2}{\DR{\REF{1}}{0}}{right=of b1}
          \sync{b1}{b2}
          \rf{a4}{b1}
          \wk[out=170,in=10]{b2}{a2}
        \end{tikzinline}}
    \end{gathered}
    \spacetag{ADDR2\XMARK}
  \end{gather*}  
\end{frame}

% \begin{frame}[label=addr]
%   \frametitle{Address Calculation Examples}
%   \vspace{-1\baselineskip}
%   \begin{gather*}
%     \spacetag{}
%     \\[1ex]
%   \end{gather*}  
% \end{frame}




\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 





\begin{frame}
  \frametitle{Examples?}
  lochbihler
  oota1
  alanAddress
  ex-1
  SB
  ex-2
\end{frame}


\begin{frame}
  \frametitle{It's going to be okay}
  \begin{itemize}[<+->]
  \item Concurrent observers see more [Plotkin and Pratt , 1990]: \emph{Teams
      Can See Pomsets}]
    \begin{itemize}
    \item compiler optimization only sound for sequential programs      
    \end{itemize}
  \item Use \emph{Sequential consistency} as correctness criterion [Lamport,
    1979]: \emph{How to Make a Multiprocessor Computer That Correctly
      Executes Multiprocess Programs}
    \begin{itemize}
    \item It's too slow
    \end{itemize}
  \item 
  \item Orange
  \end{itemize}
\end{frame}


\begin{frame}
  \setbeamercovered{transparent=30}
  \frametitle{Image for background}
  \pause
  \begin{itemize}
  \item[]
    \footnotesize
    $\begin{aligned}
      \sem{\aReg\GETS\aLoc^\amode\SEMI \aCmd} &\eqdef \textstyle\bigcup_\aVal\;
      (\DR[\amode]\aLoc\aVal)\prefix \sem{\aCmd} [\aLoc/\aReg]
      \\
      \sem{\aLoc^\amode\GETS\aExp\SEMI \aCmd} &\eqdef
      \textstyle\bigcup_\aVal\; (\aExp=\aVal \mid \DW[\amode]\aLoc\aVal)\prefix \sem{\aCmd}[\aExp/\aLoc]
    \end{aligned}$
  \item[]
    \small
    Let $\aPS'\in(\aForm \mid \aAct) \prefix \aPSS$ when
    $(\exists\aPS\in\aPSS)$
    $(\forall\aEv\in\Event)$
    % Let $(\aForm \mid \aAct) \prefix \aPSS$ be the set
    % ${\aPSS'}$ 
    % where
    % $\aPS'\in\aPSS'$ when 
    % there is $\aPS\in\aPSS$ where
    \begin{itemize}
    \item[]
      \vspace{-.5ex}
      \begin{enumerate}
      \item[{\labeltextsc[P1]{(P1)}{1}}]
        $\Event' = \Event \cup \{\bEv\}$
        % \item<1>[{\labeltextsc[P2]{(P2)}{2}}]
        %   ${\le'}\supseteq{\le}$
        % \item<1>[{\labeltextsc[P3]{(P3a)}{3a}\labeltextsc[P3]{}{3}}]%
        %   $\labelingAct'(\aEv) = \labelingAct(\aEv)$
        % \item<1>[{\labeltextsc[P3b]{(P3b)}{3b}}]
        %   $\labelingAct'(\bEv) = \aAct$
        % \item<1>[{\labeltextsc[P4a]{(P4a)}{4a}\labeltextsc[P4]{}{4}}]%
        %   $\labelingForm'(\bEv)$ implies $\aForm\land(\bEv\not\in\Event\lor\labelingForm(\bEv))$
      \item[{\labeltextsc[P4b]{(P4b)}{4b}}]
        if $\bEv\neq(\DR{..)}{}\mkern86mu$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$
      \item[{\labeltextsc[P4c]{(P4c)}{4c}}]
        if $\bEv=(\DR{\aVal}{\aLoc})\mkern75mu$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)[\aVal/\aLoc]$
      \item[{\labeltextsc[P5a]{(P5a)}{5a}\labeltextsc[P5]{}{5}}]%
        if $\bEv=(\DR{..)}{}$, $\aEv=(\DW{..)}{}$ then $\aEv=\bEv$ or $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$ or $\bEv\le'\aEv$
      \item[{\labeltextsc[P5b]{(P5b)}{5b}}]
        if $\bEv$ and $\aEv$ are conflicting actions then $\bEv\le'\aEv$
        % \item<1>[{\labeltextsc[P5c]{(P5c)}{5c}}]
        %   if $\bEv$ is an acquire or $\aEv$ is a release then $\bEv \le' \aEv$
        % \item<1>[{\labeltextsc[P5d]{(P5d)}{5d}}]
        %   if $\bEv$ is an SC write and $\aEv$ is an SC read then $\bEv \le' \aEv$
      \end{enumerate}
    \end{itemize}
  \item[]
    We say $\labelingAct(\bEv)=(\DW{x}{v})$ \emph{fulfills} $\labelingAct(\aEv)=(\DR{x}{v})$ if 
    % We say $\bEv$ \emph{fulfills $\aEv$} if 
    % % \labeltextsc[F1]{(F1)}{rf1}
    % $\labelingAct(\bEv)=\DW{x}{v}$,
    % % \labeltextsc[F2]{(F2)}{rf2}
    % $\labelingAct(\aEv)=\DR{x}{v}$,
    \begin{itemize}
    \item[]
      \vspace{-.5ex}
      \begin{itemize}
        % \item[{\labeltextsc[F1]{(F1)}{rf1}}] $\labelingAct(\bEv)=\DW{x}{v}$,
        % \item[{\labeltextsc[F2]{(F2)}{rf2}}] $\labelingAct(\aEv)=\DR{x}{v}$,
      \item%[{\labeltextsc[F3]{(F3)}{rf3}}]
        $\bEv \le \aEv$
      \item%[{\labeltextsc[F4]{(F4)}{rf4}}]
        if $\labelingAct(\cEv)=(\DW{x}{..})$ then either $\cEv \gtN \bEv$ or $\aEv \gtN \cEv$
      \end{itemize}
    \end{itemize}
  \end{itemize}
\end{frame}

\end{document}

% Local Variables:
% mode: latex
% TeX-master: t
% End:
        
