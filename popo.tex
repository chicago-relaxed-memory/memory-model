\section{Weak Ideas}
\begin{definition}[2.1]
  A \emph{memory order pomset (popo)} is a tuple
  $(\Event, {\rhb}, {\reco}, \labeling)$: 
  \begin{itemize}
  \item $\Event$ is a set of \emph{states},
  \item ${\rhb}\subseteq (\Event\times\Event)$ and ${\reco}\subseteq (\Event\times\Event)$ are partial orders, 
  \item $\labeling: \Event \fun (\Formulae\times\Act)$ is a \emph{labeling},
    from which we derive functions $\labelingForm:\Event\fun\Formulae$ and $\labelingAct:\Event\fun\Act$,
  % \item $\labeling: \Event \fun (\Formulae\times\Act\times\Sub)$ is a \emph{labeling},
  %   from which we derive functions $\labelingForm:\Event\fun\Formulae$, $\labelingAct:\Event\fun\Act$, and  $\labelingSub:\Event\fun\Sub$,
  \item if $\bEv\;({\xhb}\sequence{\xeco})\;\aEv$ then $\bEv\neq\aEv$,
  \item if $\bEv\xhb\aEv$ and $\bEv$ and $\aEv$ conflict, then $\bEv\xeco\aEv$,
  \item if $\bEv\xeco\aEv$ and $\bEv$ and $\aEv$ are SC, then $\bEv\xhb\aEv$,
  \item if $\bEv\;({\xhb}\sequence{\xeco}\sequence{\xhb})\;\aEv$ and $\bEv$ and $\aEv$ are SC Fences then $\bEv\xhb\aEv$,
  \item if $\bEv\;({\xhb}\cup{\xeco})\;\aEv$ then $\labelingForm(\aEv)$ implies $\labelingForm(\bEv)$, and
  % \item $\bigwedge\{\labelingForm(\aEv_i)\mid\forall i,j.\; \aEv_i\xpox\aEv_j \textor \aEv_j\xpox\aEv_i\}$ is satisfiable.
  \item $\bigwedge_{\aEv}\labelingForm(\aEv)$ is satisfiable.
  \end{itemize}
\end{definition}

Note we can \emph{not} require
\begin{itemize}
\item if $\bEv\;({\xhb}\cup{\xeco})\;\aEv$ then $\labelingSub(\bEv)$ subsumes
  $\labelingSub(\aEv)$.
\end{itemize}
This does not hold, for example, in $\sem{x\GETS1\SEMI x\GETS2}$.
\begin{definition}[2.4]
  We say $\bEv$ \emph{fulfills $\aEv$ on $\aLoc$} if 
  \begin{itemize}    
  \item $\bEv$ writes
    $\aVal$ to $\aLoc$, 
  \item $\aEv$ reads $\aVal$ from $\aLoc$,
  \item
    $\bEv \xhb \aEv$, and
  \item
    if $\cEv$ writes to $\aLoc$ then either $\cEv \xeco \bEv$ or $\aEv \xeco \cEv$.
  \end{itemize}
\end{definition}

\begin{definition}
  \label{def:prefix}
Two actions \emph{conflict} if one writes a location and the other
either reads or writes the same location.

Let $(\aForm \mid \aAct) \prefix \aPSS$ be the set $\PRE(\aPSS')$ where
$\aPS'\in\aPSS'$ when
there is some $\aPS\in\aPSS$ that satisfies items 1-4 of
Definition \ref{def:pre-sc} such that:
\begin{enumerate}
\item[5a.]  if $\aEv$ writes then either $\bEv\xhbp\aEv$ or
  $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$,
\item[5b.] if $\bEv$ and $\aEv$ are actions in conflict, then $\bEv\xecop\aEv$,
\item[5c.] if $\bEv$ is an acquire or $\aEv$ is a release, then $\bEv \xhbp \aEv$, and
\item[5d.] if $\bEv$ is an SC write and $\aEv$ is an SC read, then $\bEv \xhbp \aEv$.
\end{enumerate}
\end{definition}

\begin{gather*}
  x\GETS0\SEMI
  y\GETS0\SEMI
  (
  x\GETS1\SEMI\aReg\GETS y
  \PAR
  y\GETS1\SEMI \aReg\GETS x)
  \\
  \tag{\textsc{sb}}\label{SB}
  \hbox{\begin{tikzinline}[node distance=1em]
      \event{wx0}{\DW{x}{0}}{}
      \event{wy0}{\DW{y}{0}}{below=of wx0}
      \event{wx}{\DW{x}{1}}{right=of wx0}
      \event{wy}{\DW{y}{1}}{right=of wy0}
      \event{ry}{\DR{y}{0}}{right=of wx}
      \event{rx}{\DR{x}{0}}{right=of wy}
      \wk{wx0}{wx}
      \wk{wy0}{wy}
      \po{wy}{rx}
      \po{wx}{ry}
      \rf{wy0}{ry}
      \rf{wx0}{rx}
      \wk{ry}{wy}
      \wk{rx}{wx}
      % \po{rx}{wy}
    \end{tikzinline}}
\end{gather*}

\begin{gather*}
  \\[-2.5ex]
  \renewcommand{\arraycolsep}{1pt}
  \hbox{\small
    $\begin{array}{ccccc}
    &x\GETS0\SEMI x\GETS 1
    &\PAR&
    r\GETS x\ACQ \SEMI s\GETS y
    %\IF{x}\THEN r\GETS y \FI
    \\
    \PAR
    &y\GETS0\SEMI y\GETS 1
    &\PAR&
    r\GETS y\ACQ \SEMI s\GETS x
    %\IF{y}\THEN s\GETS x \FI
  \end{array}$}
  \quad
  \smash{\hbox{\begin{tikzinlinesmall}[baseline=-10pt,node distance=.5em and 1em]
  \event{wx0}{\DW{x}{0}}{}
  \event{wx1}{\DW{x}{1}}{right=of wx0}
  \event{wy0}{\DW{y}{0}}{below=2ex of wx0}
  \event{wy1}{\DW{y}{1}}{right=of wy0}
  \event{ry1}{\DRAcq{y}{1}}{right=2.5em of wy1}
  \event{rx0}{\DR{x}{0}}{right=of ry1}
  \event{rx1}{\DRAcq{x}{1}}{right=2.5 em of wx1}
  \event{ry0}{\DR{y}{0}}{right=of rx1}
  \wk{wx0}{wx1}
  \wk{wy0}{wy1}
  \rf{wx1}{rx1}
  \rf[bend left]{wy0}{ry0}
  \rf{wy1}{ry1}
  \rf[bend right]{wx0}{rx0}
  \wk{rx0}{wx1}
  \wk{ry0}{wy1}
  \po{rx1}{ry0}
  \po{ry1}{rx0}
    \end{tikzinlinesmall}}}
  \\[-1ex]
\end{gather*}

\begin{gather*}
  \hbox{\small$\IF{x}\THEN y\GETS0 \FI \SEMI y\GETS1
  {\PAR}
  \IF{y}\THEN x\GETS0 \FI \SEMI x\GETS1
  $}
  \\[-.5ex]
  \hbox{\begin{tikzinlinesmall}[node distance=1em]
  \event{a1}{\DR{x}{1}}{}
  \event{a2}{\DW{y}{0}}{right=of a1}
  \po{a1}{a2}
  \event{a3}{\DW{y}{1}}{right=of a2}
  \wk{a2}{a3}
  \event{b1}{\DR{y}{1}}{right=of a3}
  \event{b2}{\DW{x}{0}}{right=of b1}
  \po{b1}{b2}
  \event{b3}{\DW{x}{1}}{right=of b2}
  \wk{b2}{b3}
  \rf{a3}{b1}
  \rf[out=173,in=7]{b3}{a1}  
    \end{tikzinlinesmall}}
\end{gather*}
\begin{gather*}
  \hbox{\small$\IF{x}\THEN y\GETS0 \FI \SEMI y\GETS1
  {\PAR}
  \IF{y}\THEN z\GETS0 \FI \SEMI z\GETS1
  {\PAR}
  \IF{z}\THEN x\GETS0 \FI \SEMI x\GETS1
  $}
  \\[-.5ex]
  \hbox{\begin{tikzinlinesmall}[node distance=1em]
  \event{a1}{\DR{x}{1}}{}
  \event{a2}{\DW{y}{0}}{right=of a1}
  \po{a1}{a2}
  \event{a3}{\DW{y}{1}}{right=of a2}
  \wk{a2}{a3}
  \event{b1}{\DR{y}{1}}{right=of a3}
  \event{b2}{\DW{z}{0}}{right=of b1}
  \po{b1}{b2}
  \event{b3}{\DW{z}{1}}{right=of b2}
  \wk{b2}{b3}
  \event{c1}{\DR{z}{1}}{right=of b3}
  \event{c2}{\DW{x}{0}}{right=of c1}
  \po{c1}{c2}
  \event{c3}{\DW{x}{1}}{right=of c2}
  \wk{c2}{c3}
  \rf{a3}{b1}
  \rf{b3}{c1}
  \rf[out=173,in=7]{c3}{a1}  
    \end{tikzinlinesmall}}
\end{gather*}

\begin{gather*}
    x\GETS1
    \PAR
    r\GETS x\SEMI   
    \FENCE^{\modeSC}\SEMI
    r\GETS y  
    \PAR
    y\GETS 1 \SEMI
    \FENCE^{\modeSC}\SEMI
    r\GETS x  
    \\[-.1ex]
  \hbox{\begin{tikzinline}[node distance=1em]
  \event{a1}{\DW{x}{1}}{}
  \event{b1}{\DR{x}{1}}{right=3em of a1}
  \event{b2}{\DFS{\modeSC}}{right=of b1}
  \po{b1}{b2}
  \event{b3}{\DR{y}{0}}{right=of b2}
  \po{b2}{b3}
  \event{c1}{\DW{y}{1}}{right=3em of b3}
  \event{c2}{\DFS{\modeSC}}{right=of c1}
  \po{c1}{c2}
  \event{c3}{\DR{x}{0}}{right=of c2}
  \po{c2}{c3}
  \wk{b3}{c1}
  \rf{a1}{b1}
  \wk[out=-170,in=-10]{c3}{a1}
    \end{tikzinline}}
  \\
    x\GETS1\SEMI   
    z\REL\GETS1\SEMI   
    \PAR
    r\ACQ\GETS z\SEMI   
    \FENCE^{\modeSC}\SEMI
    r\GETS y  
    \PAR
    y\GETS 1 \SEMI
    \FENCE^{\modeSC}\SEMI
    r\GETS x  
    \\[-.1ex]
  \hbox{\begin{tikzinline}[node distance=.7em]
  \event{a1}{\DW{x}{1}}{}
  \event{a2}{\DWRel{z}{1}}{right=of a1}
  \po{a1}{a2}
  \event{b1}{\DRAcq{z}{1}}{right=2em of a2}
  \event{b2}{\DFS{\modeSC}}{right=of b1}
  \po{b1}{b2}
  \event{b3}{\DR{y}{0}}{right=of b2}
  \po{b2}{b3}
  \event{c1}{\DW{y}{1}}{right=2em of b3}
  \event{c2}{\DFS{\modeSC}}{right=of c1}
  \po{c1}{c2}
  \event{c3}{\DR{x}{0}}{right=of c2}
  \po{c2}{c3}
  \wk{b3}{c1}
  \rf{a2}{b1}
  \wk[out=-170,in=-10]{c3}{a1}
    \end{tikzinline}}
\end{gather*}
