% OOPSLA: double-blind reviewing 
% Submitted papers may be at most 23 pages in 10 point font, excluding
% bibliographic references and appendices.

% Novelty: The paper presents new ideas and results and places them
% appropriately within the context established by previous research. 

% Importance: The paper contributes to the advancement of knowledge in the
% field. We also welcome papers that diverge from the dominant trajectory of
% the field. 

% Evidence: The paper presents sufficient evidence supporting its claims,
% such as proofs, implemented systems, experimental results, statistical
% analyses, case studies, and anecdotes. 

% Clarity: The paper presents its contributions, methodology and results clearly.


\RequirePackage{amssymb}  %% bizarre error previous def of Bbbk if after documentclass
\documentclass[acmsmall,review,anonymous,screen]{acmart}\settopmatter{printfolios=true}
\hypersetup{bookmarksnumbered,bookmarksopen=true,bookmarksdepth=1}
%\makeatletter\if@ACM@anonymous\acmSubmissionID{{}}\fi\makeatother %Including this in anonymous so page breaks are right for version with institutions
\settopmatter{printfolios=true}
\AtEndPreamble{%
  % \theoremstyle{acmdefinition}
  % \theoremstyle{plain}
  % \newtheorem{theorem}{Theorem}[section]
  % \newtheorem{proposition}[theorem]{Proposition}
  % \theoremstyle{acmdefinition}
  % \newtheorem{definition}[theorem]{Definition}
  \theoremstyle{acmdefinition}
  \newtheorem{remark}[theorem]{Remark}
  \newtheorem{candidate}[theorem]{Candidate}
  \renewcommand{\theequation}{\fnsymbol{equation}}
}
%% For single-blind review submission


%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format should change 'acmsmall' to
%% 'sigplan'.

%\documentclass[acmsmall,screen]{acmart}


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption



% \makeatletter\if@ACM@journal\makeatother
% %% Journal information (used by PACMPL format)
% %% Supplied to authors by publisher for camera-ready submission
% \acmJournal{PACMPL}
% \acmVolume{1}
% \acmNumber{1}
% \acmArticle{1}
% \acmYear{2017}
% \acmMonth{1}
% \acmDOI{10.1145/nnnnnnn.nnnnnnn}
% \startPage{1}
% \else\makeatother
% %% Conference information (used by SIGPLAN proceedings format)
% %% Supplied to authors by publisher for camera-ready submission
% \acmConference[PL'17]{ACM SIGPLAN Conference on Programming Languages}{January 01--03, 2017}{New York, NY, USA}
% \acmYear{2017}
% \acmISBN{978-x-xxxx-xxxx-x/YY/MM}
% \acmDOI{10.1145/nnnnnnn.nnnnnnn}
% \startPage{1}
% \fi


%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission
% \setcopyright{none}             %% For review submission
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2017}           %% If different from \acmYear


%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations

% AFAICT this is the only way to get the copyright notice to be CC-BY-4.0
% which is the recommended license for POPL 2020.
\setcopyright{rightsretained}
\begin{makeatletter}
  \gdef\@copyrightpermission{%
    This paper is published under the Creative Commons Attribution~4.0
    International (CC-BY~4.0) license.
  }
\end{makeatletter}

\usepackage{macros}

% % at most 12 pages, excluding references, not anonymous
% % Titles and Short Abstracts Due	4 January 2019
% % Full Papers Due	11 January 2019
% % Author Feedback/Rebuttal Period	4–8 March 2019
% % Author Notification	29 March 2019
% % Conference	24–27 June 2019
% \documentclass[conference]{IEEEtran}
% \IEEEoverridecommandlockouts

\usepackage{macros}

\begin{document}

%% Title information
\title{Pomsets with Preconditions}
\subtitle{A Simple Model of Relaxed Memory}
%\title[Let go of that which does not serve you]{Let go of that which does not serve you: Semantic~Independence in a Model of Relaxed Memory}
% \title{Semantic Dependency as a Model of Relaxed Memory}
% \title[Short Title]{Full Title}         %% [Short Title] is optional;
%                                         %% when present, will be used in
%                                         %% header instead of Full Title.
% \titlenote{with title note}             %% \titlenote is optional;
%                                         %% can be repeated if necessary;
%                                         %% contents suppressed with 'anonymous'

% \subtitle{Subtitle}                     %% \subtitle is optional
% \subtitlenote{with subtitle note}       %% \subtitlenote is optional;
%                                         %% can be repeated if necessary;
%                                         %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.


\author{Radha Jagadeesan}
\affiliation{
  %\department{School of Computing}
  \institution{DePaul University}
  %\country{USA}
}
%\email{rjagadeesan@cs.depaul.edu}

\author{Alan Jeffrey}
\orcid{0000-0001-6342-0318}
\affiliation{
  \institution{Mozilla Research}
  %\country{USA}
}
%\email{ajeffrey@mozilla.com}

\author{James Riely}
\orcid{0000-0002-8731-1463}
\affiliation{
  %\department{School of Computing}
  \institution{DePaul University}
  %\country{USA}
}
%\email{jriely@cs.depaul.edu}


%% Paper note
\thanks{Radha Jagadeesan and James Riely were supported in part by NSF CCR}
%% The \thanks command may be used to createame a "paper note" ---
%% similar to a title note or an author note, but not explicitly
%% associated with a particular element.  It will appear immediately
%% above the permission/copyright statement.
%                                         %% can be repeated if necesary
%                                         %% contents suppressed with 'anonymous'


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
\input{abstract}
\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10003752.10003753.10003761.10003762</concept_id>
<concept_desc>Theory of computation~Parallel computing models</concept_desc>
<concept_significance>500</concept_significance>
</concept>
% <concept>
% <concept_id>10003752.10003753.10003761.10003763</concept_id>
% <concept_desc>Theory of computation~Distributed computing models</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
% <concept>
% <concept_id>10003752.10003753.10003761.10003764</concept_id>
% <concept_desc>Theory of computation~Process calculi</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
% <concept>
% <concept_id>10003752.10003790.10002990</concept_id>
% <concept_desc>Theory of computation~Logic and verification</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
% <concept>
% <concept_id>10003752.10010124.10010131.10010133</concept_id>
% <concept_desc>Theory of computation~Denotational semantics</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>TT
% <concept>
% <concept_id>10003752.10010124.10010131.10010134</concept_id>
% <concept_desc>Theory of computation~Operational semantics</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
% <concept>
% <concept_id>10003752.10010124.10010131.10010135</concept_id>
% <concept_desc>Theory of computation~Axiomatic semantics</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
<concept>
<concept_id>10003752.10010124.10010138.10011119</concept_id>
<concept_desc>Theory of computation~Abstraction</concept_desc>
<concept_significance>500</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Theory of computation~Parallel computing models}
% \ccsdesc[500]{Theory of computation~Distributed computing models}
% \ccsdesc[500]{Theory of computation~Process calculi}
% \ccsdesc[500]{Theory of computation~Logic and verification}
% \ccsdesc[500]{Theory of computation~Denotational semantics}
% \ccsdesc[500]{Theory of computation~Operational semantics}
% \ccsdesc[500]{Theory of computation~Axiomatic semantics}
\ccsdesc[500]{Theory of computation~Abstraction}
 

%% End of generated code


%% Keywords
%% comma separated list
\keywords{Relaxed Memory Models, Pomsets, Preconditions, Hoare Logic,
  Temporal Safety Properties, Compiler Optimizations, Thin-Air Reads} %% \keywords is optional


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

% \title{What Happened}

% \author{
% \IEEEauthorblockN{Radha Jagadeesan}
% \IEEEauthorblockA{\textit{DePaul University}\\
%   \email{rjagadeesan@cs.depaul.edu}}
% \and
% \IEEEauthorblockN{Alan Jeffrey}
% \IEEEauthorblockA{\textit{Mozilla Research}\\
%   \email{ajeffrey@mozilla.com}}
% \and
% \IEEEauthorblockN{James Riely}
% \IEEEauthorblockA{\textit{DePaul University}\\
%   \email{jriely@cs.depaul.edu}}
% }

\input{intro}
\input{model}
\input{variants}
\input{logic}
\input{short}
\input{opt}%\input{oldopt}
\input{outro}
\clearpage
\begin{small}
\bibliography{bib}
\end{small}
\clearpage
\appendix
%\input{semicolon}
\input{promising}
\input{appendix}
\newpage
\input{outlineforgeneralreader}
\color{red}
Section 2.5 could use some smoothing.    Move candidate 2.11 down two
paragraphs.  When discussing (*), mention the substitution in 2.11

Section 2.7 should say that the second rule for write does not require a new action.

Everywhere we have SB, it could be SB/LB.  I think there is space for both.

At Co2, point out that this is not arbitrary, but needed to validate CSE.

At Co3, point out that this stops races from the past from sneaking in.

TC16 is coherence... we don't do that one.


Should say explicitly that we allow load buffering


A sentence I like but deleted (originally near RFUB):

This example shows the wisdom of using existing tools, such as Hoare logic,
to model new problems, such as relaxed memory.  We don't need to abandon
established techniques, we only need to adapt them.

Comments from Radha:

Linear is incorrect as stated. eg. skip is Hoare equiv to r=x;x =r (which is
linear) but cannot be substituted by it.  It is necessary to add the proviso
linear AND (writes only if original program writes)


a. Defn of linear needs to forbid reads after writes. 

The theorem does not hold for:
   x=1; r=x
vs
   x=1

They are both linear. Satisfy the same hoare triples.  But have different
read(C)


b. For the record.  I'm uncomfortable about DRF proof sketch.  If it comes to
that, I'd like a careful flushing out of the "assumed closure conditions"

REF A:

> Details:

> The claim that this "supports all reasonable sequential compiler
> optimizations" seems prone to misinterpretation. Section 7 correctly points
> out several kinds of sequential optimizations that are not correct in a
> concurrent setting. 

> The statement about relaxed accesses not requiring hardware synchronization
> could use more explanation. Relaxed accesses currently require special
> instructions on Itanium. They clearly require special instructions for
> accesses larger than natively supported by the hardware. 

> At line 51, it hasn't yet been explained that s is not shared.

> Line 72: I don't believe that "undefined behavior" here is actually a
> weakness. This seems like just an instance of the observation that every
> substantial program has bugs. I also no longer believe that Java is really
> substantively different here. It does try to give defined semantics to
> language-level races. But it does not for racing standard (or other) library
> calls. For "substantial programs", the latter kind of races are not going to
> be that much less frequent than the former. Furthermore, the fact that low
> level races have defined behavior makes it harder to justify simple race
> detectors, which would usually also detect the latter. Java's security goals
> for untrusted code forced its approach, but those goals have generally not
> been met anyway. 

> I found the definition of substitution confusing. Please add an example or two.

> Line 132: Calling memory orders "fencing actions" seems weird to me. Fences
> order two large groups of accesses with respect to each other. These don't.  

> Line 153 is questionable. Whether plain and relaxed accesses are the same for
> race-free code depends on OOTA treatment, which isn't yet resolved. Consider
> if (x) y := 1 || if (y) x := 1 . 

> Line 745: "is preceded by a reading 1 for z": What's "a"?


REF B

> - 53 "resulting" what did the JMM result from?
> - 61 I don't understand what the "lack of composability" is here
> - 99 what does it mean to "compile" a formal model to an architecture?
> - 191 "fulfilled" and "satisfied" are only defined several pages later.
> - 230 "the semantics is also closed with respect to ..." but the semantics
>   hasn't even been defined yet.
> - 252 "used define"
> - 266 I really liked the diagrams. it would be worth clarifying that the
>   depicted pomset is one element of the semantics of the given program (and that
>   this semantics is still undefined at this point)
> - 283 "top-level" where do we use this term? if only much later, it would help
>   to define it right before we need it.
> - 289 I almost missed this transition. please visually mark when you are
>   defining semantics for each case
> - 310 again, mark new cases in the definition. these are really hard to find at
>   a glance, and it is very easy to get lost in 2.4 (which is essentially one
>   enormous definition)
> - 331 what is "eco"?
> - 360 "The semantics is again driven by Hoare logic" I could not understand
>   this. the semantics of Hoare logic should be defined in terms of the program
>   semantics, but we are currently defining the program semantics. Unless the
>   paper is referring to an existing semantics of Hoare logic? (this should be
>   clearly cited or better, displayed in the paper).
> - 436 again, I do not understand this "justified by Hoare logic" comment.
> - 568 "control dependencies" what color are these arrows?
> - 779 "eco" this is not discussed after Def. 2.5
> - 797 I could also not follow this section. A high-level question: what are we
>   trying to show in this section? What is the goal? This section introduces a
>   ton of definitions, states a theorem and sketches a proof, but I don't
>   understand what the goal is.
> - 825 why is this theorem interesting? what is the intuitive meaning?
> - 876 "roach motel laws" citation?





REF C

> I struggled in some places with typesetting. Line 282 is a good example.
> Eventually I figured out the intention is that this is meant to be read as if
> the previous line ends with "Then we define:", but for a long while these just
> seemed like dangling equations. Perhaps this just reflects badly on me, though.
> (It would be much clearer in a mechanized model! :-))

> Minor stuff:
> * Line 331: eco is never defined (same problem at line 789)



REF D

> The authors should compare their model to the thin-air solution of
> "Modular Relaxed Dependencies in Weak Memory Concurrency" from ESOP
> 2020.

> The authors say they deal with all Java causality tests (line 557).
> Tests 19 and 20 include join, but the language does not seem to provide
> the facility to join. How are tests 19 and 20 accounted for?

> In section 5, does dropping parts of dependency-ordered-before produce a
> strictly weaker model of ARMv8? I want to be sure this is the proper
> compilation result.


> Minor comments:

> An example on page 5 uses pointer dereferencing before it is added to
> the language.

> On page 5 and line 639, the use of the terms "states" and "events"
> confused me for a while.

> The inverted delta subscript for downset was not introduced at the
> definition of downset.


> Line 331: eco not defined or referenced.
> Lines 323 and 340: "trivial" and "general" expressions. These sound like keywords but are not defined.




bib:

\cite{DBLP:journals/lmcs/KavanaghB19} previous pomset approaches.

\cite{10.1145/2694344.2694391} gpus

Batty Mark 2017
Compositional relaxed concurrency
Phil. Trans. R. Soc. A.
http://doi.org/10.1098/rsta.2015.0406


\end{document}

% Local Variables:
% mode: latex
% TeX-master: t
% End:
