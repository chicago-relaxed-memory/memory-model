\documentclass[t,aspectratio=169]{beamer} %tlmgr install translator
% \includeonlyframes{current}  %%%% USE: \begin{frame}[label=current]
\usepackage{macros}
\usepackage{talk}
\begin{comment}
  \begin{frame}
    \frametitle{}
    \begin{itemize}
    \item 
    \end{itemize}
  \end{frame}
  \begin{itemize}
  \item 
  \end{itemize}

  Great Beamer guide here:
  https://www.overleaf.com/learn/latex/Beamer_Presentations:_A_Tutorial_for_Beginners_(Part_4)â€”Overlay_Specifications

  How to present on mac without blurring:
  Use firefox, or Presentation.app
  https://tex.stackexchange.com/questions/431423/os-x-blurry-beamer-presentations-on-sierra-high-sierra

  To convert from PDF to KeyNOTE: use the automator suggestion here
  https://apple.stackexchange.com/questions/95856/import-multiple-pages-from-a-pdf-as-separate-slides-in-keynote
  I put the automator app here: https://www.dropbox.com/sh/1o36nes45cydmbx/AADPVWpeEBZj2vemVXkGKQXVa?dl=0
  - Copy that to your machine somewhere.
  - In the finder, drop talk.pdf onto "PDF Save Pages as Images.app".
  - This will create a bunch of png files on the desktop
  - Now, open keynote with a blank document.
  - In the finder, select the files, drop onto the leftmost "slides" pane of Keynote.

  Another display option is to use http://dspdfviewer.danny-edel.de, which requires
  \usepackage{pgfpages}
  \setbeameroption{show notes on second screen}
  You can use the keys "t" and "d" to get different things on the presenter screen

  \pause
  \onslide<>

  \visible<>{during}                 visibleenv
  \invisible<>{other}                invisibleenv

  \onslide<>{during}
  \uncover<>{during}                 uncoverenv

  \only<>{during}                    onlyenv
  \alt<>{during}{other}              altenv
  \temporal<>{before}{during}{after}
  \setbeamercovered{transparent=35}


  \begin{itemize}[<+-| alert@+>]
  \item Apple
  \item Peach
  \item Plum
  \item Orange
  \end{itemize}
\end{comment}

\title{Pomsets with Preconditions}
\subtitle{A Simple Model of Relaxed Memory}
\author{Radha Jagadeesan$^\dagger$ \and Alan Jeffrey$^*$ \and James Riely$^\dagger$}
\date{October 2020}
\institute{$^\dagger$DePaul University \and $^*$Mozilla Research and the Servo Project}

% \usepackage{pgfpages}\setbeameroption{show notes on second screen}
\setbeamertemplate{navigation symbols}{\insertframenumber/\inserttotalframenumber}
\begin{document}
\begin{frame}
  \maketitle
\end{frame}
% \begin{frame}
%   \begin{framecenter}
%     \Huge
%     Shared Memory Concurrency \\
%     \vfill
%     \uncover<2->{Transactions} %\\ to augment or replace locks} \\
%     \vfill
%     \uncover<3->{Programmer Model?}
%   \end{framecenter}
% \end{frame}

\begin{frame}
  \frametitle{Can this program write 1 to z?}
  \begin{gather*}
    y\GETS x
    \PAR
    \alt<4>{x\GETS y}{r\GETS y \SEMI x\GETS r}
    \invisible<3-4>{\SEMI z\GETS r}
  \end{gather*}
  \onslide<2->
  $r$ is a register\\
  $x$, $y$, $z$ are shared memory locations, initially $0$

  \bigskip \bigskip
  \onslide<5->
  No!
  
  \onslide<6->
  \bigskip \bigskip
  what about
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \alert{\IF{r}\THEN} x\GETS r\SEMI z\GETS r \alert{\ELSE x\GETS1 \FI}
  \end{gather*}
\end{frame}

\begin{frame}
  \frametitle{Can this program write 1 to z?}  
  \vspace{-2\baselineskip}
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE \only<7>{\alert}{x\GETS\alt<6>{2}{1}} \FI
  \end{gather*}
  \pause
  $x$ and $y$ can only be $0$ or $\alt<6>{2}{1}$  
  \begin{gather*}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    \IF{r}\THEN x\GETS r\SEMI z\GETS \alt<6>{2}{1} \ELSE \only<7>{\alert}{x\GETS\alt<6>{2}{1}} \FI
  \end{gather*}
  \pause
  lift common code
  \begin{gather*}
    % \taglabelpp{OOTA?}
    y\GETS x
    \PAR
    r\GETS y\SEMI
    x\GETS\alt<6>{2}{1}\SEMI
    \IF{r}\THEN z\GETS \alt<6>{2}{1} \FI
  \end{gather*}
  \pause
  commute independent statements
  \begin{gather*}
    % \taglabelpp{OOTA?}
    \only<5>{\alert}{y\GETS x}
    \PAR
    x\GETS\alt<6>{2}{1}\SEMI
    r\GETS y\SEMI
    \IF{r}\THEN z\GETS \alt<6>{2}{1} \FI
  \end{gather*}
  \pause
  interleaving
  \begin{gather*}
    % \taglabelpp{OOTA?}
    x\GETS\alt<6>{2}{1}\SEMI
    \alert<5>{y\GETS x}\SEMI
    r\GETS y\SEMI
    \IF{r}\THEN z\GETS \alt<6>{2}{1} \FI
  \end{gather*}
\end{frame}

\imagepage{images/abomb3.jpg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=198310}{Image in the Public domain}}
% \imagepage{images/flowers.jpg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.006.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.007.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

% \imagepage{images/katorisi.jpeg}{\href{https://commons.wikimedia.org/wiki/File:Tulips,Hitachi_Seaside_Park,Hitachinaka-city,Japan.JPG}{Image
% by Katorisi, 2010, Creative Commons}}


\begin{frame}
  \frametitle{Semantic Domain}
  \begin{itemize}
  \item 
    A \emph{pomset with preconditions} is a tuple
    $(\Event, {\le}, %{\leloc},
    \labeling)$ where
    \begin{itemize}
    \item $\Event$ is a set of \emph{events}
    \item ${\le} \subseteq (\Event\times\Event)$ is a partial order
    \item<+-> $\labeling: \Event \fun (\Formulae\times\Act)$ is a \emph{labeling}
      from which we derive functions
      \begin{itemize}
      \item $\labelingForm:\Event\fun\Formulae$ \emph{(formulae)} % include $r{=}v$  $x{=}v$
      \item $\labelingAct:\Event\fun\Act$  \emph{(actions)} %include $\DW{x}{v}$, $\DR{x}{v}$, and $\DSTOP$
      \end{itemize}
    \item<+-> $\bigwedge_{\aEv}\labelingForm(\aEv)$ is satisfiable
      \emph{(consistency)}
    \item<+-> if $\bEv\le\aEv$ then $\labelingForm(\aEv)$ implies
      $\labelingForm(\bEv)$ \emph{(causal strengthening)}
    \end{itemize}
  \item<+->
    We say $\labelingAct(\bEv)=(\DW{x}{v})$ \emph{fulfills} $\labelingAct(\aEv)=(\DR{x}{v})$ if 
    % We say $\bEv$ \emph{fulfills $\aEv$} if 
    % % \labeltextsc[F1]{(F1)}{rf1}
    % $\labelingAct(\bEv)=\DW{x}{v}$,
    % % \labeltextsc[F2]{(F2)}{rf2}
    % $\labelingAct(\aEv)=\DR{x}{v}$,
    \begin{itemize}
      % \item[{\labeltextsc[F1]{(F1)}{rf1}}] $\labelingAct(\bEv)=\DW{x}{v}$,
      % \item[{\labeltextsc[F2]{(F2)}{rf2}}] $\labelingAct(\aEv)=\DR{x}{v}$,
    \item%[{\labeltextsc[F3]{(F3)}{rf3}}]
      $\bEv \lt \aEv$
    \item<+->%[{\labeltextsc[F4]{(F4)}{rf4}}]
      if $\labelingAct(\cEv)=(\DW{x}{..})$ then either $\cEv \gtN \bEv$ or $\aEv \gtN \cEv$
    \end{itemize}
  \item<+->
    A pomset is \emph{$\aLoc$-closed} if
    \begin{itemize}
    \item every $\labelingAct(\aEv)=(\DR{\aLoc}{..})$ is fulfilled
    \item<+-> every $\labelingForm(\aEv)$ is independent of $x$: $\bigl(\forall v.\;\labelingForm(\aEv) \vDash \labelingForm(\aEv)[\aVal/\aLoc] \vDash
      \labelingForm(\aEv)\bigr)$
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Semantic Operations (1/2)}
  \begin{itemize}[<+->]
  \item
    Let $\aPS\phantom{'}\in(\nu\aLoc\!\DOT\!\aPSS) \mkern22mu$ when $\phantom{(\exists}\aPS\in\aPSS$
    and $\aPS$ is $\aLoc$-closed
    % Let $(\nu\aLoc\!\DOT\!\aPSS)$ be  $\aPSS'\subseteq\aPSS$ where $\aPS'\in\aPSS'$
    % when $\aPS'$ is $\aLoc$-closed
  \item 
    % Let $(\aForm \guard \aPSS)$ be the set $\aPSS'\subseteq\aPSS$ where
    % $\aPS'\in\aPSS'$ when $\labelingForm(\aEv')$ implies $\aForm$
    Let $\aPS\phantom{'}\in(\aForm \guard \aPSS)\mkern16mu$ when $\phantom{(\exists}\aPS\in\aPSS$ and 
    $(\forall\aEv\in\Event)$ $\labelingForm(\aEv)$ implies $\aForm$
  \item 
    Let $\aPS'\in(\aPSS[M/x])\mkern2mu$ when
    $(\exists\aPS\in\aPSS$)\\\qquad $\Event' = \Event$, ${\le'} = {\le}$,
    $\labelingAct' = \labelingAct$, and
    $(\forall\aEv\in\Event')$ $\labelingForm'(\aEv) = \labelingForm(\aEv)[M/x]$
    % % Let $(\aPSS\aSub)$
    % Let $(\aPSS[M/x])$
    % be the set $\aPSS'$ where $\aPS'\in\aPSS'$ when there is
    % $\aPS\in\aPSS$ where\\ $\Event' = \Event$, ${\le'} = {\le}$,
    % $\labelingAct' = \labelingAct$, and
    % $\labelingForm'(\aEv) = \labelingForm(\aEv)[M/x]$
    % % $\labelingForm'(\aEv) = \labelingForm(\aEv)\aSub$
    
    
  \item 
    Let $\aPS' \in (\aPSS^1 \parallel \aPSS^2)$ when
    $(\exists\aPS^1 \in \aPSS^1)$ $(\exists\aPS^2 \in \aPSS^2)$
    \\% $\aPS^1$ is completed exactly when $\aPS^2$ is completed, there is at most one termination in $\Event'$,
    \qquad $\Event' = \Event^1 \cup \Event^2$,
    ${\le'}\supseteq{\le^1}\cup{\le^2}$, and $(\forall\aEv\in\Event')$ either
    \begin{gather*}
      \begin{aligned}
        \aEv \not\in \Event^2,\; \labelingAct'(\aEv) &= \labelingAct^1(\aEv) \textand \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv),
        \\[-1ex]
        \aEv \not\in \Event^1,\; \labelingAct'(\aEv) &= \labelingAct^2(\aEv) \textand \labelingForm'(\aEv) \textimplies \labelingForm^2(\aEv),\textor
        \\[-1ex]
        \labelingAct'(\aEv) = \labelingAct^1(\aEv) &= \labelingAct^2(\aEv) \textand \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv) \lor \labelingForm^2(\aEv)
      \end{aligned}
    \end{gather*}
    % \begin{itemize}
    % \item $\labelingAct'(\aEv) = \labelingAct^1(\aEv) = \labelingAct^2(\aEv) \textand \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv) \lor \labelingForm^2(\aEv),$
    % \item $\aEv \not\in \Event^2,\; \labelingAct'(\aEv) = \labelingAct^1(\aEv) \textand \labelingForm'(\aEv) \textimplies \labelingForm^1(\aEv),$ or
    % \item $\aEv \not\in \Event^1,\; \labelingAct'(\aEv) = \labelingAct^2(\aEv) \textand \labelingForm'(\aEv) \textimplies \labelingForm^2(\aEv)$.
    % \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}<1-2>
  \setbeamercovered{transparent=15}
  \frametitle{Semantic Operations (2/2)}
  \begin{itemize}
  \item Let $\aPS'\in(\aForm \mid \aAct) \prefix \aPSS$ when
    $(\exists\aPS\in\aPSS)$
    $(\forall\aEv\in\Event)$
    \begin{enumerate}
    \item[{\labeltextsc[P1]{(P1)}{1}}]
      $\Event' = \Event \cup \{\bEv\}$
    \item<1>[{\labeltextsc[P2]{(P2)}{2}}]
      ${\le'}\supseteq{\le}$
    \item<1>[{\labeltextsc[P3]{(P3a)}{3a}\labeltextsc[P3]{}{3}}]%
      $\labelingAct'(\aEv) = \labelingAct(\aEv)$
    \item<1>[{\labeltextsc[P3b]{(P3b)}{3b}}]
      $\labelingAct'(\bEv) = \aAct$
    \item<1>[{\labeltextsc[P4a]{(P4a)}{4a}\labeltextsc[P4]{}{4}}]%
      $\labelingForm'(\bEv)$ implies $\aForm$
    \item[{\labeltextsc[P4b]{(P4b)}{4b}}]
      if $\labelingAct(\bEv)=(\DR{\aVal}{\aLoc})\mkern4mu$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)[\aVal/\aLoc]$
    \item[{\labeltextsc[P4c]{(P4c)}{4c}}]
      if $\labelingAct(\bEv)=(\DW{..)}{\phantom{\aLoc}}$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$
    \item[{\labeltextsc[P5a]{(P5a)}{5a}\labeltextsc[P5]{}{5}}]%
      if $\labelingAct(\aEv)\mkern1.8mu=(\DW{..)}{\phantom{\aLoc}}$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$ or $\bEv\lt'\aEv$
    \item<1>[{\labeltextsc[P5b]{(P5b)}{5b}}]
      if $\bEv$ and $\aEv$ are conflicting actions then $\bEv\lt'\aEv$
    \item<1>[{\labeltextsc[P5c]{(P5c)}{5c}}]
      if $\bEv$ is an acquire or $\aEv$ is a release then $\bEv \lt' \aEv$
    \item<1>[{\labeltextsc[P5d]{(P5d)}{5d}}]
      if $\bEv$ is an SC write and $\aEv$ is an SC read then $\bEv \lt' \aEv$
    \end{enumerate}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Language}
  \begin{gather*}
    % \begin{aligned}
    %   \aCmd,\,\bCmd
    %   \BNFDEF& \SKIP
    %   \BNFSEP \aReg\GETS\aExp\SEMI \aCmd
    %   \BNFSEP \aReg\GETS\aLoc^{\amode}\SEMI \aCmd 
    %   \BNFSEP \aLoc^{\amode}\GETS\aExp\SEMI \aCmd
    %   \\[-.5ex]
    %   \BNFSEP&\aCmd \PAR[\aThrd][\bThrd] \bCmd
    %   \BNFSEP \VAR\aLoc\SEMI \aCmd
    %   \BNFSEP \IF{\aExp} \THEN \aCmd \ELSE \bCmd \FI
    % \end{aligned}
    % \\
    \begin{aligned}
      \sem[\aThrd]{\SKIP} & \eqdef
      \alert<2>{\{ \DSTOP \}}
      \\
      \sem[\aThrd]{\aReg\GETS\aExp\SEMI \aCmd} & \eqdef
      \sem[\aThrd]{\aCmd}\alert<3>{[\aExp/\aReg]}
      \\ 
      \sem{\aReg\GETS\aLoc^\amode\SEMI \aCmd} & \eqdef \textstyle\bigcup_\aVal\;
      \alert<4>{(\DR[\uncover<8>{\alert<8>{\amode}}]\aLoc\aVal)\prefix} \sem{\aCmd} \alert<3>{[\aLoc/\aReg]}
      \\
      \sem{\aLoc^\amode\GETS\aExp\SEMI \aCmd} & \eqdef
      \textstyle\bigcup_\aVal\; \alert<4>{(\aExp=\aVal \mid \DW[\uncover<8>{\alert<8>{\amode}}]\aLoc\aVal)\prefix} \sem{\aCmd}\alert<3>{[\aExp/\aLoc]}
      \\
      \sem[\aThrd]{\IF{\aExp} \THEN \aCmd \ELSE \bCmd \FI} & \eqdef
      \bigl(\alert<5>{\aExp \guard} \sem[\aThrd]{\aCmd}\bigr) \alert<6>{\parallel} \bigl(\alert<5>{\lnot\aExp \guard} \sem[\aThrd]{\bCmd}\bigr) 
      \\
      \sem[\aThrd]{\aCmd \PAR[\bThrd][\bThrd'] \bCmd} & \eqdef
      \sem[\bThrd]{\aCmd} \alert<6>{\parallel} \sem[\bThrd']{\bCmd} 
      \\
      \sem[\aThrd]{\VAR\aLoc\SEMI \aCmd} & \eqdef
      \alert<7>{\nu \aLoc \DOT} \sem[\aThrd]{\aCmd}  
    \end{aligned}
  \end{gather*}
  \uncover<8>{
    \begin{align*}
      \alert<8>{\amode} \BNFDEF& \modeRLX &&\text{{(Relaxed)}}
      \\ \BNFSEP& \modeRA &&\text{{(Release/Acquire)}}
      \\ \BNFSEP& \modeSC &&\text{{(Sequentially Consistent)}}
    \end{align*}}
\end{frame}

\imagepage{images/keynote-images/keynote-images.007.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}

\begin{imageframe}{images/keynote-images/keynote-images.014.jpeg}{}
  \frametitle{Sequential Semantics}

  \begin{gather*}
    \begin{gathered}
      \only<9->{\IF{r}\THEN}
      \only<4->{x\GETS r\SEMI}
      z\GETS r
      \only<9->{\FI}
      \\
      \only<1>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}0\mid\DW{z}{0}}{}
          \end{tikzinline}}}
      \only<2>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}1\mid\DW{z}{1}}{}
          \end{tikzinline}}}
      \only<3>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}2\mid\DW{z}{2}}{}
          \end{tikzinline}}}
      \only<4>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}0\mid\DW{z}{0}}{}
            \event{wx}{r{=}0\mid\DW{x}{0}}{left=of wz}
          \end{tikzinline}}}
      \only<5,8>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}1\mid\DW{z}{1}}{}
            \event{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
      \only<6-7>{\hbox{\begin{tikzinline}[node distance=.5em]
            \alt<7>{\nonevent}{\event}{wz}{r{=}\alert{2}\mid\DW{z}{\alert{2}}}{}
            \alt<7>{\event}{\event}{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
      \only<9>{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{\neq}0 \land r{=}1\mid\DW{z}{1}}{}
            \event{wx}{r{\neq}0 \land r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
      \only<10->{\hbox{\begin{tikzinline}[node distance=.5em]
            \event{wz}{r{=}1\mid\DW{z}{1}}{}
            \event{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \end{tikzinline}}}
    \end{gathered}
    \only<8->{\qquad \qquad\qquad\begin{gathered}
        \only<9->{\IF{\lnot r}\THEN}
        x\GETS \alt<12>{\alert{2}}{1}
        \only<9->{\FI}
        \\
        \only<8>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{1{=}1\mid\DW{x}{1}}{}
            \end{tikzinline}}}
        \only<9>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{r{=}0 \land 1{=}1\mid\DW{x}{1}}{}
            \end{tikzinline}}}
        \only<10-11,13>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{r{=}0\mid\DW{x}{1}}{}
            \end{tikzinline}}}
        \only<12>{\hbox{\begin{tikzinline}[node distance=.5em]
              \event{wx}{r{=}0\mid\DW{x}{\alert{2}}}{}
            \end{tikzinline}}}
      \end{gathered}}
  \end{gather*}
  \begin{center}
    \only<1>{Precondition records dependence on $r$}
    \only<2-3>{One pomset for each value}
    \only<4-5>{Two writes = two events per pomset}
    \only<6-7>{Preconditions must be consistent}% $r{=}0$ and $r{=}1$ are \emph{inconsistent}}
    \only<8>{A separate program}
    \only<9>{Adding control}
    \only<10>{Simplifying}
    \only<11->{Combining both sides}
  \end{center}
  \begin{gather*}
    \only<11->{\IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS \alt<12>{\alert{2}}{1}\FI}
    \\
    \only<11>{\hbox{\begin{tikzinline}[node distance=.5em]
          \event{wz}{r{=}1\mid\DW{z}{1}}{}
          \event{wx}{r{=}1\lor r{=}0\mid\DW{x}{1}}{left=of wz}
        \end{tikzinline}}}    
    \only<12-13>{\hbox{\begin{tikzinline}[node distance=.5em]
          \alt<12>{\event}{\nonevent}{wz}{r{=}1\mid\DW{z}{1}}{}
          \alt<12>{\event}{\nonevent}{wx}{r{=}1\mid\DW{x}{1}}{left=of wz}
          \alt<12>{\event}{\nonevent}{wxx}{r{=}0\mid\DW{x}{\alert{2}}}{right=of wz}
        \end{tikzinline}}}    
  \end{gather*}
  \begin{center}
    \only<11>{We can coalesce the writes to $x$}
    \only<12>{We \emph{cannot} coalesce the writes to $x$}
    \only<13->{Preconditions must be consistent}
  \end{center}
\end{imageframe}


\begin{imageframe}{images/keynote-images/keynote-images.014.jpeg}{}
  \frametitle{Sequential Semantics}

  \begin{gather*}
    \uncover<8->{y\GETS 0\SEMI}
    \uncover<2->{r\GETS y\SEMI}
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS 1\FI
    \\
    \only<1-2>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wz}{\alt<1>{r}{y}{=}1\mid\DW{z}{1}}{}
          \event{wx}{\alt<1>{r}{y}{=}1\lor \alt<1>{r}{y}{=}0\mid\DW{x}{1}}{left=of wz}
        \end{tikzinline}}}
    \only<3>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{(y{=}1\lor y{=}0)\land(1{=}1\lor 1{=}0)\mid\DW{x}{1}}{}
          \event{wz}{(y{=}1) \land (1{=}1)\mid\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
        \end{tikzinline}}}
    \only<4-5>{\hbox{\begin{tikzinline}[node distance=2em]
          \alt<4>{\event}{\nonevent}{wx}{(y{=}1\lor y{=}0)\land(\alert{2}{=}1\lor \alert{2}{=}0)\mid\DW{x}{1}}{}
          \alt<4>{\event}{\nonevent}{wz}{(y{=}1) \land (\alert{2}{=}1)\mid\DW{z}{1}}{right=of wx}
          \alt<4>{\event}{\nonevent}{ry}{\DR{y}{\alert{2}}}{left=of wx}
        \end{tikzinline}}}
    \only<6-7>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{(y{=}1\lor y{=}0)\land(1{=}1\lor 1{=}0)\mid\DW{x}{1}}{}
          \event{wz}{(\alt<6>{y}{\alert{1}}{=}1) \land (1{=}1)\mid\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \po[out=-15,in=-165]{ry}{wz}
        \end{tikzinline}}}
    \only<8-9>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{(\alert{0}{=}1\lor \alert{0}{=}0)\land(1{=}1\lor 1{=}0)\mid\DW{x}{1}}{}
          \event{wz}{(1{=}1) \land (\alert{1}{=}1)\mid\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{0{=}0\mid\DW{y}{0}}{left=of ry}
          \po[out=-15,in=-165]{ry}{wz}
        \end{tikzinline}}}
    \only<10>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \po[bend right]{ry}{wz}
        \end{tikzinline}}}
  \end{gather*}
  \begin{center}
    \only<1>{Let's start fresh here}
    \only<2>{To prepend, $r\GETS y $, we first substitute $[y/r]$}
    \only<3>{We then add the action, and its constraint: $\aForm'\vDash\aForm[v/y]$}
    \only<4-5>{Incompatible reads are disallowed}
    \only<6>{Order may be introduced}
    \only<7>{Order enables substitution $[v/y]$}
    \only<8>{Prepending $y\GETS 0$ substitutes $[0/y]$}
    \only<9>{[\alert{1}/y] from $\DR{y}{1}$ requires order, [\alert{0}/y] from $\DW{y}{0}$ does not}
    \only<10>{Simplifying tautologies}
  \end{center}
\end{imageframe}

\begin{imageframe}{images/keynote-images/keynote-images.015.jpeg}{}<1-3>
  \frametitle{Concurrent Semantics}

  \begin{gather*}
    \only<2->{x\GETS 0\SEMI}
    y\GETS 0\SEMI
    \only<3->{(y\GETS x \PAR}
    r\GETS y\SEMI
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS \alt<9>{\alert{2}}{1}\FI
    \only<3->{)}
    \\
    \only<1>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \po[bend right]{ry}{wz}
          \wk{wy}{ry}
        \end{tikzinline}}}
    \only<2>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \event{wx0}{\DW{x}{0}}{left=of wy}
          \po[bend right]{ry}{wz}
          \wk{wy}{ry}
          \wk[out=-22,in=-158]{wx0}{wx}
        \end{tikzinline}}}
    \only<3->{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wy0}{\DW{y}{0}}{}
          \event{wx0}{\DW{x}{0}}{left=of wy0}
          \event{rx1}{\DR{x}{1}}{right=3em of wy0}
          \event{wy1}{\DW{y}{1}}{right=of rx1}
          \event{ry1}{\DR{y}{1}}{right=3em of wy1}
          \event{wx1}{\DW{x}{1}}{right=of ry1}
          \event{wa1}{\DW{z}{1}}{right=of wx1}
          \only<3>{
            \wk[out=-22,in=-158]{wx0}{rx1}
            \wk[out=-22,in=-158]{wy0}{ry1}
          }
          \only<4->{
            \rf[out=-165,in=-15]{wx1}{rx1}
            \rf{wy1}{ry1}
          }
          \only<9->{
            \po{ry1}{wx1}
          }
          \wk[out=-18,in=-162]{wx0}{wx1}
          \wk[out=-22,in=-158]{wy0}{wy1}
          \po{rx1}{wy1}
          \po[bend right]{ry1}{wa1}
        \end{tikzinline}}}
  \end{gather*}
  \begin{center}
    \only<1>{Must preserve order on \emph{conflicting} accesses (WW, WR)}
    \only<2>{Initializing $x$}
    \only<3>{Introducing $y\GETS x$}
    \only<4>{Fulfillment requirements}
    \only<5-8>{Allowed!
      \uncover<6->{\\ Partial order}
      \uncover<7->{\\ All reads fulfilled}
      \uncover<8->{\\ All preconditions tautologies}
    }
    \only<9->{Disallowed!
      \uncover<9->{\\ Cycle}
    }
  \end{center}
\end{imageframe}
\begin{imageframe}{images/keynote-images/keynote-images.016.jpeg}{}<4->
  \frametitle{Concurrent Semantics}

  \begin{gather*}
    \only<2->{x\GETS 0\SEMI}
    y\GETS 0\SEMI
    \only<3->{(y\GETS x \PAR}
    r\GETS y\SEMI
    \IF{r}\THEN x\GETS r\SEMI z\GETS r \ELSE x\GETS \alt<9>{\alert{2}}{1}\FI
    \only<3->{)}
    \\
    \only<1>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \po[bend right]{ry}{wz}
          \wk{wy}{ry}
        \end{tikzinline}}}
    \only<2>{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wx}{\DW{x}{1}}{}
          \event{wz}{\DW{z}{1}}{right=of wx}
          \event{ry}{\DR{y}{1}}{left=of wx}
          \event{wy}{\DW{y}{0}}{left=of ry}
          \event{wx0}{\DW{x}{0}}{left=of wy}
          \po[bend right]{ry}{wz}
          \wk{wy}{ry}
          \wk[out=-22,in=-158]{wx0}{wx}
        \end{tikzinline}}}
    \only<3->{\hbox{\begin{tikzinline}[node distance=2em]
          \event{wy0}{\DW{y}{0}}{}
          \event{wx0}{\DW{x}{0}}{left=of wy0}
          \event{rx1}{\DR{x}{1}}{right=3em of wy0}
          \event{wy1}{\DW{y}{1}}{right=of rx1}
          \event{ry1}{\DR{y}{1}}{right=3em of wy1}
          \event{wx1}{\DW{x}{1}}{right=of ry1}
          \event{wa1}{\DW{z}{1}}{right=of wx1}
          \only<3>{
            \wk[out=-22,in=-158]{wx0}{rx1}
            \wk[out=-22,in=-158]{wy0}{ry1}
          }
          \only<4->{
            \rf[out=-165,in=-15]{wx1}{rx1}
            \rf{wy1}{ry1}
          }
          \only<9->{
            \po{ry1}{wx1}
          }
          \wk[out=-18,in=-162]{wx0}{wx1}
          \wk[out=-22,in=-158]{wy0}{wy1}
          \po{rx1}{wy1}
          \po[bend right]{ry1}{wa1}
        \end{tikzinline}}}
  \end{gather*}
  \begin{center}
    \only<1>{Must preserve order on \emph{conflicting} accesses (WW, WR)}
    \only<2>{Initializing $x$}
    \only<3>{Introducing $y\GETS x$}
    \only<4>{Fulfillment requirements}
    \only<5-8>{Allowed!
      \uncover<6->{\\ Partial order}
      \uncover<7->{\\ All reads fulfilled}
      \uncover<8->{\\ All preconditions tautologies}
    }
    \only<9->{Disallowed!
      \uncover<9->{\\ Cycle}
    }
  \end{center}
\end{imageframe}


\begin{frame}
  \frametitle{Reading Values Out Of Thin Air (OOTA)}
Eliding $0$-initialization:
\begin{gather*}
  % y\GETS0\SEMI
  y\GETS x
  \PAR
  % x\GETS0\SEMI
  % z\GETS0\SEMI
  \IF{b}\THEN  r\GETS y \SEMI x\GETS r \SEMI z\GETS r \ELSE x\GETS1 \FI
  \PAR
  %b\GETS0\SEMI
  b\GETS1
  \\
  \uncover<2->{\hbox{\begin{tikzinline}[node distance=1.5em]
      \event{rx}{\DR{x}{1}}{}
      \event{wy}{\DW{y}{1}}{right=of rx}
      \po{rx}{wy}
      \event{ry}{\DR{y}{1}}{right=3em of wy} 
      \event{wx}{\DW{x}{1}}{right=of ry}
      \event{wz}{\DW{z}{1}}{right=of wx}
      \event{rb}{\DR{b}{1}}{right=of wz}
      \event{wb1}{\DW{b}{1}}{right=3em of rb}
      \po{ry}{wx}
      \rf{wb1}{rb}
      \rf[out=15,in=165]{wy}{ry}
      \rf[out=-170,in=-10]{wx}{rx}
      \po{rb}{wz}
      \po[out=15,in=165]{ry}{wz}
    \end{tikzinline}}}
\end{gather*}
\emph{writing $1$ for $x$ is preceded by reading $0$ for $z$}

\end{frame}


\imagepage{images/keynote-images/keynote-images.008.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.009.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.010.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.011.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.012.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}
\imagepage{images/keynote-images/keynote-images.013.jpeg}{\href{https://www.publicdomainpictures.net/en/view-image.php?image=365530}{Image in the Public domain}}



\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{frame}<2->
  \setbeamercovered{transparent=15}
  \frametitle{Key Definitions}
  \begin{itemize}
  \item
    \begin{math}
      \sem{\aReg\GETS\aLoc^\amode\SEMI \aCmd} \eqdef \textstyle\bigcup_\aVal\;
      (\DR[\amode]\aLoc\aVal)\prefix \sem{\aCmd} [\aLoc/\aReg]
    \end{math}
  \item
    \begin{math}
      \sem{\aLoc^\amode\GETS\aExp\SEMI \aCmd} \eqdef
      \textstyle\bigcup_\aVal\; (\aExp=\aVal \mid \DW[\amode]\aLoc\aVal)\prefix \sem{\aCmd}[\aExp/\aLoc]
    \end{math}
  \item 
    Let $(\aForm \mid \aAct) \prefix \aPSS$ be the set
    ${\aPSS'}$ 
    where
    $\aPS'\in\aPSS'$ when 
    there is $\aPS\in\aPSS$ where
    \begin{enumerate}
    \item[{\labeltextsc[P1]{(P1)}{1}}]
      $\Event' = \Event \cup \{\bEv\}$
    \item<1>[{\labeltextsc[P2]{(P2)}{2}}]
      ${\le'}\supseteq{\le}$
    \item<1>[{\labeltextsc[P3]{(P3a)}{3a}\labeltextsc[P3]{}{3}}]%
      $\labelingAct'(\aEv) = \labelingAct(\aEv)$
    \item<1>[{\labeltextsc[P3b]{(P3b)}{3b}}]
      $\labelingAct'(\bEv) = \aAct$
    \item<1>[{\labeltextsc[P4a]{(P4a)}{4a}\labeltextsc[P4]{}{4}}]%
      $\labelingForm'(\bEv)$ implies $\aForm$
    \item[{\labeltextsc[P4b]{(P4b)}{4b}}]
      if $\labelingAct(\bEv)=(\DR{\aVal}{\aLoc})\mkern4mu$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)[\aVal/\aLoc]$
    \item[{\labeltextsc[P4c]{(P4c)}{4c}}]
      if $\labelingAct(\bEv)=(\DW{..)}{\phantom{\aLoc}}$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$
    \item[{\labeltextsc[P5a]{(P5a)}{5a}\labeltextsc[P5]{}{5}}]%
      if $\labelingAct(\aEv)\mkern1.8mu=(\DW{..)}{\phantom{\aLoc}}$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$ or $\bEv\lt'\aEv$
    \item<1>[{\labeltextsc[P5b]{(P5b)}{5b}}]
      if $\bEv$ and $\aEv$ are conflicting actions then $\bEv\lt'\aEv$
    \item<1>[{\labeltextsc[P5c]{(P5c)}{5c}}]
      if $\bEv$ is an acquire or $\aEv$ is a release then $\bEv \lt' \aEv$
    \item<1>[{\labeltextsc[P5d]{(P5d)}{5d}}]
      if $\bEv$ is an SC write and $\aEv$ is an SC read then $\bEv \lt' \aEv$
    \end{enumerate}
  \end{itemize}
\end{frame}




\begin{frame}
  \frametitle{Examples?}
  lochbihler
  oota1
  alanAddress
  ex-1
  SB
  ex-2
\end{frame}


\begin{frame}
  \frametitle{It's going to be okay}
  \begin{itemize}[<+->]
  \item Concurrent observers see more [Plotkin and Pratt , 1990]: \emph{Teams
    Can See Pomsets}]
    \begin{itemize}
    \item compiler optimization only sound for sequential programs      
    \end{itemize}
  \item Use \emph{Sequential consistency} as correctness criterion [Lamport,
    1979]: \emph{How to Make a Multiprocessor Computer That Correctly
    Executes Multiprocess Programs}
    \begin{itemize}
    \item It's too slow
    \end{itemize}
  \item 
  \item Orange
  \end{itemize}
\end{frame}


\begin{frame}
  \setbeamercovered{transparent=30}
  \frametitle{Image for background}
  \pause
  \begin{itemize}
  \item[]
  \footnotesize
  $\begin{aligned}
    \sem{\aReg\GETS\aLoc^\amode\SEMI \aCmd} &\eqdef \textstyle\bigcup_\aVal\;
    (\DR[\amode]\aLoc\aVal)\prefix \sem{\aCmd} [\aLoc/\aReg]
    \\
    \sem{\aLoc^\amode\GETS\aExp\SEMI \aCmd} &\eqdef
    \textstyle\bigcup_\aVal\; (\aExp=\aVal \mid \DW[\amode]\aLoc\aVal)\prefix \sem{\aCmd}[\aExp/\aLoc]
  \end{aligned}$
  \item[]
  \small
  Let $\aPS'\in(\aForm \mid \aAct) \prefix \aPSS$ when
    $(\exists\aPS\in\aPSS)$
    $(\forall\aEv\in\Event)$
    % Let $(\aForm \mid \aAct) \prefix \aPSS$ be the set
    % ${\aPSS'}$ 
    % where
    % $\aPS'\in\aPSS'$ when 
    % there is $\aPS\in\aPSS$ where
    \begin{itemize}
    \item[]
      \vspace{-.5ex}
      \begin{enumerate}
    \item[{\labeltextsc[P1]{(P1)}{1}}]
      $\Event' = \Event \cup \{\bEv\}$
    % \item<1>[{\labeltextsc[P2]{(P2)}{2}}]
    %   ${\le'}\supseteq{\le}$
    % \item<1>[{\labeltextsc[P3]{(P3a)}{3a}\labeltextsc[P3]{}{3}}]%
    %   $\labelingAct'(\aEv) = \labelingAct(\aEv)$
    % \item<1>[{\labeltextsc[P3b]{(P3b)}{3b}}]
    %   $\labelingAct'(\bEv) = \aAct$
    % \item<1>[{\labeltextsc[P4a]{(P4a)}{4a}\labeltextsc[P4]{}{4}}]%
    %   $\labelingForm'(\bEv)$ implies $\aForm$
    \item[{\labeltextsc[P4b]{(P4b)}{4b}}]
      if $\labelingAct(\bEv)=(\DR{\aVal}{\aLoc})\mkern4mu$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)[\aVal/\aLoc]$
    \item[{\labeltextsc[P4c]{(P4c)}{4c}}]
      if $\labelingAct(\bEv)=(\DW{..)}{\phantom{\aLoc}}$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$
    \item[{\labeltextsc[P5a]{(P5a)}{5a}\labeltextsc[P5]{}{5}}]%
      if $\labelingAct(\aEv)\mkern1.8mu=(\DW{..)}{\phantom{\aLoc}}$ then $\labelingForm'(\aEv)$ implies $\labelingForm(\aEv)$ or $\bEv\lt'\aEv$
    \item[{\labeltextsc[P5b]{(P5b)}{5b}}]
      if $\bEv$ and $\aEv$ are conflicting actions then $\bEv\lt'\aEv$
    % \item<1>[{\labeltextsc[P5c]{(P5c)}{5c}}]
    %   if $\bEv$ is an acquire or $\aEv$ is a release then $\bEv \lt' \aEv$
    % \item<1>[{\labeltextsc[P5d]{(P5d)}{5d}}]
    %   if $\bEv$ is an SC write and $\aEv$ is an SC read then $\bEv \lt' \aEv$
    \end{enumerate}
  \end{itemize}
\item[]
      We say $\labelingAct(\bEv)=(\DW{x}{v})$ \emph{fulfills} $\labelingAct(\aEv)=(\DR{x}{v})$ if 
    % We say $\bEv$ \emph{fulfills $\aEv$} if 
    % % \labeltextsc[F1]{(F1)}{rf1}
    % $\labelingAct(\bEv)=\DW{x}{v}$,
    % % \labeltextsc[F2]{(F2)}{rf2}
    % $\labelingAct(\aEv)=\DR{x}{v}$,
    \begin{itemize}
    \item[]
      \vspace{-.5ex}
    \begin{itemize}
      % \item[{\labeltextsc[F1]{(F1)}{rf1}}] $\labelingAct(\bEv)=\DW{x}{v}$,
      % \item[{\labeltextsc[F2]{(F2)}{rf2}}] $\labelingAct(\aEv)=\DR{x}{v}$,
    \item%[{\labeltextsc[F3]{(F3)}{rf3}}]
      $\bEv \lt \aEv$
    \item%[{\labeltextsc[F4]{(F4)}{rf4}}]
      if $\labelingAct(\cEv)=(\DW{x}{..})$ then either $\cEv \gtN \bEv$ or $\aEv \gtN \cEv$
    \end{itemize}
  \end{itemize}
\end{itemize}
\end{frame}

\end{document}

% Local Variables:
% mode: latex
% TeX-master: t
% End:
